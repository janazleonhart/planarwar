{
   "schemaVersion": 1,
   "services": {
      "abilities.types": {
         "kind": "model",
         "path": "worldcore/abilities/AbilityTypes.ts",
         "functions": [
            "findAbilityByNameOrId"
         ],
         "dependsOn": [
            "actions.types",
            "combat.engine",
            "mud.resources"
         ],
         "notes": [
            "Defines AbilityKind and AbilityDefinition plus ABILITIES map (e.g. warrior_power_strike, warrior_cleave) with channel, weaponSkill, resourceType, damage multipliers, and cooldownMs.",
            "findAbilityByNameOrId resolves abilities by id or case-insensitive name."
         ]
      },
      "actions.types": {
         "kind": "model",
         "path": "worldcore/actions/ActionTypes.ts",
         "notes": [
            "Defines AttackChannel ('weapon'|'spell'|'ability') and ActionRequest union over AttackActionRequest and HarvestActionRequest.",
            "Used as the transport-neutral action envelope for MUD and future 2.5D clients."
         ]
      },
      "actions.worldService": {
         "kind": "service",
         "path": "worldcore/actions/WorldActionService.ts",
         "functions": [
            "performAction"
         ],
         "dependsOn": [
            "actions.types",
            "mud.actions"
         ],
         "notes": [
            "Shared entry point for generic world actions (v1: attack + harvest) across MUD and future clients.",
            "Currently delegates to MudActions.handleAttackAction and handleGatherAction and returns ActionResult with message lines."
         ]
      },
      "ai.behaviorContext": {
         "kind": "model",
         "path": "worldcore/ai/brains/BehaviorContext.ts",
         "notes": [
            "Defines BehaviorContext (perception, players, cooldownMs, attackCooldownMs, setCooldownMs, optional guardMemory) and GuardMemory helpers.",
            "BehaviorHandler type is a pure function BehaviorContext -> NpcDecision|null."
         ]
      },
      "ai.brainTypes": {
         "kind": "model",
         "path": "worldcore/ai/NpcBrainTypes.ts",
         "notes": [
            "Defines NpcPerception, PerceivedPlayer, and NpcDecision variants (idle, attack_entity, move_to_room, say, flee) plus NpcBrain interface.",
            "Engine-agnostic AI contract usable in-process or over-the-wire to a remote AI service."
         ]
      },
      "ai.brains.aggressive": {
         "kind": "service",
         "path": "worldcore/ai/brains/AggressiveBrain.ts",
         "functions": [
            "decideAggressiveBehavior"
         ],
         "dependsOn": [
            "ai.brainTypes",
            "ai.behaviorContext"
         ],
         "notes": [
            "Aggressive brain: if no cooldown and at least one player, attacks the first player and resets cooldown; otherwise returns null.",
            "Always uses melee attack_style for now."
         ]
      },
      "ai.brains.coward": {
         "kind": "service",
         "path": "worldcore/ai/brains/CowardBrain.ts",
         "functions": [
            "decideCowardBehavior"
         ],
         "dependsOn": [
            "ai.brainTypes",
            "ai.behaviorContext",
            "ai.brains.aggressive"
         ],
         "notes": [
            "Coward brain: if HP < maxHp, emits a flee decision away from the first perceived player; otherwise defers to aggressive behavior."
         ]
      },
      "ai.brains.guard": {
         "kind": "service",
         "path": "worldcore/ai/brains/GuardBrain.ts",
         "functions": [
            "pickGuardTarget",
            "decideGuardBehavior"
         ],
         "dependsOn": [
            "ai.brainTypes",
            "ai.behaviorContext"
         ],
         "notes": [
            "Guard brain: targets players with recent crime, preferring healer > dps > tank and lower HP, and can warn or call for help based on severity and safe-hub status.",
            "Uses guardMemory to avoid spamming warnings and to track help calls."
         ]
      },
      "ai.brains.neutral": {
         "kind": "service",
         "path": "worldcore/ai/brains/NeutralBrain.ts",
         "functions": [
            "decideNeutralBehavior"
         ],
         "dependsOn": [
            "ai.behaviorContext",
            "ai.brainTypes"
         ],
         "notes": [
            "Neutral brain: always returns null; used for non-hostile NPCs that currently do nothing."
         ]
      },
      "ai.localSimpleBrain": {
         "kind": "service",
         "path": "worldcore/ai/LocalSimpleNpcBrain.ts",
         "class": "LocalSimpleAggroBrain",
         "functions": [
            "decide"
         ],
         "dependsOn": [
            "ai.brainTypes"
         ],
         "notes": [
            "Simple in-process NPC brain that attacks the first player in room on a cooldown and makes cowards flee once injured.",
            "Tracks per-NPC cooldown in memory keyed by npcId."
         ]
      },
      "auction.auditLog": {
         "kind": "service",
         "path": "worldcore/auction/AuctionAuditLog.ts",
         "functions": [
            "logAuctionEvent"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "auction.types"
         ],
         "notes": [
            "Writes auction_log rows with shard, listing id, actor info, action, and JSON details for create/buy/cancel/expire/claim/reclaim events.",
            "Failures are logged via Logger.scope('AUCTION_AUDIT') but never thrown back to callers."
         ]
      },
      "auction.format": {
         "kind": "service",
         "path": "worldcore/auction/AuctionFormat.ts",
         "functions": [
            "formatAuctionListing"
         ],
         "dependsOn": [
            "auction.types",
            "mud.context"
         ],
         "notes": [
            "Builds a one-line MUD description for a listing like '#12 Hematite Iron Ore [common] x20 \u2013 3g each (total 60g) by Testing [active]'.",
            "Looks up item definitions via ctx.items?.get to resolve item name and rarity."
         ]
      },
      "auction.postgres": {
         "kind": "service",
         "path": "worldcore/auction/PostgresAuctionService.ts",
         "class": "PostgresAuctionService",
         "functions": [
            "browse",
            "get",
            "createListing",
            "buyout",
            "cancelListing",
            "listBySeller",
            "claimProceeds",
            "expireOld",
            "reclaimExpiredForSeller"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "auction.types",
            "auction.service",
            "auction.auditLog"
         ],
         "notes": [
            "Postgres-backed AuctionService using auctions table; maps AuctionRow to AuctionListing via rowToListing.",
            "Implements search + pagination, creates active listings with expires_at TTL, marks rows sold/cancelled/expired, tracks proceeds, and supports reclaiming expired items for sellers."
         ]
      },
      "auction.service": {
         "kind": "service_contract",
         "path": "worldcore/auction/AuctionService.ts",
         "functions": [
            "browse",
            "get",
            "createListing",
            "buyout",
            "cancelListing",
            "listBySeller",
            "claimProceeds",
            "expireOld",
            "reclaimExpiredForSeller"
         ],
         "dependsOn": [
            "auction.types"
         ],
         "notes": [
            "AuctionService interface for browsing, creating, buying out, cancelling, expiring, and reclaiming auctions plus claiming proceeds.",
            "Used by PostgresAuctionService and MUD commands."
         ]
      },
      "auction.types": {
         "kind": "model",
         "path": "worldcore/auction/AuctionTypes.ts",
         "notes": [
            "Defines AuctionStatus ('active'|'sold'|'cancelled'|'expired') and AuctionListing with shard, seller, buyer, item, pricing, and proceeds fields.",
            "Used across auction services, formatting, and audit logging."
         ]
      },
      "auth.debugGate": {
         "kind": "service",
         "path": "worldcore/auth/debugGate.ts",
         "functions": [
            "getShardMode",
            "canUseDebugCommands",
            "requireDebug"
         ],
         "dependsOn": [
            "auth.types"
         ],
         "notes": [
            "Gatekeeper for debug commands based on identity flags and shard mode.",
            "Disallows debug commands on live shards and enforces minimum StaffRole threshold."
         ]
      },
      "auth.postgres": {
         "kind": "service",
         "path": "worldcore/auth/PostgresAuthService.ts",
         "class": "PostgresAuthService",
         "functions": [
            "registerAccount",
            "loginWithPassword",
            "verifyToken",
            "getAccountById"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "auth.service",
            "auth.types"
         ],
         "notes": [
            "Postgres + JWT implementation of AuthService with PBKDF2 password hashing and signed tokens.",
            "Persists flags JSONB on accounts, logs auth events, and returns AuthResult with expiry timestamp."
         ]
      },
      "auth.service": {
         "kind": "service_contract",
         "path": "worldcore/auth/AuthService.ts",
         "functions": [
            "registerAccount",
            "loginWithPassword",
            "verifyToken",
            "getAccountById"
         ],
         "dependsOn": [
            "auth.types"
         ],
         "notes": [
            "Abstract auth API over accounts: register, login, token verification, and profile lookup.",
            "AccountFlags include staff/debug knobs such as isGM, isDev, isOwner, isTester, isShardBuilder."
         ]
      },
      "auth.staffAudit": {
         "kind": "service",
         "path": "worldcore/auth/StaffAuditLog.ts",
         "functions": [
            "logStaffAction"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "auth.types"
         ],
         "notes": [
            "Writes rows into staff_action_log with actor id/name, actionName, and JSON details.",
            "Errors are logged but never allowed to break the calling staff command."
         ]
      },
      "auth.staffRoles": {
         "kind": "model",
         "path": "worldcore/auth/StaffRoles.ts",
         "notes": [
            "Defines StaffRole ('player'|'guide'|'gm'|'dev'|'owner') and StaffRoleLevel numeric mapping.",
            "Used for permission checks and debug/staff tools."
         ]
      },
      "auth.types": {
         "kind": "model",
         "path": "worldcore/shared/AuthTypes.ts",
         "functions": [
            "getStaffRole",
            "getStaffTier",
            "isGuide",
            "isGMOrHigher",
            "isDevOrHigher",
            "isOwner"
         ],
         "notes": [
            "Shared auth/identity model: UserId, CharacterId, ShardId, AccountFlags, AccountProfile, CharacterSummary, AuthTokenPayload, AuthResult, AttachedIdentity.",
            "Also provides staff role helpers and StaffRole/StaffRoleLevel for permission checks."
         ]
      },
      "bank.economyHelpers": {
         "kind": "utility",
         "path": "worldcore/bank/BankEconomyHelpers.ts",
         "functions": [
            "getBankGold",
            "setBankGold",
            "addBankGold"
         ],
         "dependsOn": [
            "bank.service"
         ],
         "notes": [
            "Small helpers to read, clamp, and mutate bank.gold balance on BankState.",
            "Used by higher-level bank operations and services."
         ]
      },
      "bank.ops": {
         "kind": "service",
         "path": "worldcore/bank/bankOps.ts",
         "functions": [
            "addToBankSlots",
            "formatBankView",
            "takeFromInventoryExactSlot",
            "bankDepositFromInventorySlot"
         ],
         "dependsOn": [
            "bank.service",
            "items.service",
            "items.catalog",
            "characters.types",
            "bank.types",
            "economy.helpers",
            "bank.economyHelpers"
         ],
         "notes": [
            "High-level bank operations: stack-aware deposits, formatted bank views, and inventory-slot transfers.",
            "Handles unknown items by rolling back via giveItemsToCharacter and returns leftovers when the bank is full."
         ]
      },
      "bank.postgres": {
         "kind": "service",
         "path": "worldcore/bank/PostgresBankService.ts",
         "class": "PostgresBankService",
         "functions": [
            "getBank",
            "saveBank"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "bank.service",
            "bank.types"
         ],
         "notes": [
            "Postgres-backed implementation using bank_slots and bank_accounts tables.",
            "Maintains a fixed BANK_SLOT_COUNT, loads slots ordered by index, and persists both gold and per-slot item stacks in a transaction."
         ]
      },
      "bank.service": {
         "kind": "service_contract",
         "path": "worldcore/bank/BankService.ts",
         "functions": [
            "getBank",
            "saveBank"
         ],
         "dependsOn": [
            "bank.types",
            "characters.types"
         ],
         "notes": [
            "BankService interface over BankState with typed ownerKind.",
            "Supports loading/creating a bank and saving the full slot + gold state."
         ]
      },
      "bank.types": {
         "kind": "model",
         "path": "worldcore/bank/BankTypes.ts",
         "notes": [
            "Defines BankOwnerKind ('account'|'character'|'guild'|'city') and BankOwnerRef.",
            "Used across all bank operations and commands to address the correct bank entity."
         ]
      },
      "characters.db": {
         "kind": "service",
         "path": "worldcore/characters/PostgresCharacterService.ts",
         "class": "PostgresCharacterService",
         "functions": [
            "listCharactersForUser",
            "loadCharacter",
            "loadCharacterForUser",
            "createCharacter",
            "saveCharacter",
            "patchCharacter",
            "grantXp",
            "learnSpell",
            "equipItem"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "characters.types",
            "characters.leveling",
            "classes.definitions"
         ],
         "notes": [
            "Postgres-backed character service using the characters table and CharacterRow \u2192 CharacterState mapping.",
            "Supports partial JSONB patching, XP/level gains with per-class attribute growth, and spell/equipment updates."
         ]
      },
      "characters.leveling": {
         "kind": "service",
         "path": "worldcore/characters/Leveling.ts",
         "functions": [
            "xpForNextLevel",
            "applyXp"
         ],
         "notes": [
            "Simple linear XP curve (100 * level) used by PostgresCharacterService.",
            "applyXp applies a delta, loops level-ups, and returns a LevelingResult with old/new levels and XP plus leveledUp flag."
         ]
      },
      "characters.persist": {
         "kind": "service",
         "path": "worldcore/characters/characterPersist.ts",
         "functions": [
            "persistCharacterSnapshot"
         ],
         "dependsOn": [
            "characters.db",
            "shared.session"
         ],
         "notes": [
            "Utility that snapshots the current CharacterState from a MUD context into Postgres via ctx.characters.patchCharacter.",
            "Persists position, region, attributes, inventory, equipment, spellbook, abilities, and progression."
         ]
      },
      "characters.service": {
         "kind": "service_contract",
         "path": "worldcore/characters/CharacterService.ts",
         "functions": [
            "listCharactersForUser",
            "createCharacter",
            "loadCharacter",
            "saveCharacter"
         ],
         "dependsOn": [
            "auth.types",
            "characters.types"
         ],
         "notes": [
            "Backend-agnostic character API shared by MMO shard, webend, and tools.",
            "Uses UserId/CharacterId/ShardId and CharacterState/Summary types."
         ]
      },
      "characters.sheet": {
         "kind": "service",
         "path": "worldcore/characters/characterSheet.ts",
         "functions": [
            "buildCharacterSheetLine"
         ],
         "dependsOn": [
            "combat.entityCombat",
            "world.regionText",
            "characters.stats"
         ],
         "notes": [
            "Builds a single-line textual character sheet including name, class, level, XP, HP, status, shard, region, base and effective attributes, and active title name.",
            "Uses computeEffectiveAttributes plus entity HP/in-combat flags for status labeling."
         ]
      },
      "characters.stateGuard": {
         "kind": "service",
         "path": "worldcore/characters/CharacterStateGuard.ts",
         "functions": [
            "hydrateCharacterRegion"
         ],
         "dependsOn": [
            "characters.types",
            "world.manager",
            "utils.logger"
         ],
         "notes": [
            "Ensures CharacterState.lastRegionId matches the region resolved by ServerWorldManager at posX/posZ.",
            "Logs region changes for debugging and returns either original or updated CharacterState."
         ]
      },
      "characters.stats": {
         "kind": "service",
         "path": "worldcore/characters/Stats.ts",
         "functions": [
            "computeEffectiveAttributes"
         ],
         "dependsOn": [
            "characters.types",
            "items.catalog",
            "items.service",
            "characters.titles"
         ],
         "notes": [
            "Computes effective attributes by cloning base attributes, then applying item stat bonuses from ItemService or ItemCatalog and active title bonuses from TITLES.",
            "Used by characterSheet and any system that needs gear-adjusted attributes."
         ]
      },
      "characters.titles": {
         "kind": "model",
         "path": "worldcore/characters/TitleTypes.ts",
         "functions": [
            "getTitleDefinition",
            "listAllTitles"
         ],
         "notes": [
            "Defines TitleDefinition and TITLES map including rat_slayer and ore_breaker unlocks and attribute bonuses.",
            "Used both by progression.titles.* and characterStats for bonus application."
         ]
      },
      "characters.types": {
         "kind": "model",
         "path": "worldcore/characters/CharacterTypes.ts",
         "functions": [
            "defaultAttributes",
            "defaultInventory",
            "defaultEquipment",
            "defaultSpellbook",
            "defaultAbilities",
            "defaultProgression",
            "rowToCharacterState",
            "toCharacterSummary"
         ],
         "notes": [
            "Canonical CharacterRow and CharacterState model plus typed v1.5 JSONB blobs for attributes, inventory, equipment, spellbook, abilities, and progression.",
            "Includes SimpleTask/QuestState integration in ProgressionState and helpers to transform DB rows into in-memory state and UI CharacterSummary DTOs."
         ]
      },
      "classes.definitions": {
         "kind": "model",
         "path": "worldcore/classes/ClassDefinitions.ts",
         "functions": [
            "getClassDefinition",
            "getCombatRoleForClass",
            "getPerLevelAttributesForClass",
            "getPrimaryResourceForClass",
            "getPowerResourcesForClass",
            "getAllClassDefinitions"
         ],
         "notes": [
            "Defines ClassId, ClassDefinition, CombatRole, archetypes, and class power resources plus full CLASS_DEFINITIONS and CLASS_PER_LEVEL tables for Virtuoso, Illusionist, Adventurer, legacy Warrior/Mage/Rogue/Priest, and others.",
            "Provides helpers for per-level attribute gains, primary/secondary resources, favored schools/weapon skills, and armor/weapon access."
         ]
      },
      "combat.cooldowns": {
         "kind": "service",
         "path": "worldcore/combat/Cooldowns.ts",
         "functions": [
            "ensureCooldownBucket",
            "getCooldownRemaining",
            "startCooldown",
            "checkAndStartCooldown"
         ],
         "dependsOn": [
            "characters.types"
         ],
         "notes": [
            "Stores cooldowns under char.progression.cooldowns[bucket][key].",
            "Provides helpers to query remaining time and atomically check+start cooldowns with user-facing error strings."
         ]
      },
      "combat.engine": {
         "kind": "service",
         "path": "worldcore/combat/CombatEngine.ts",
         "functions": [
            "computeDamage"
         ],
         "dependsOn": [
            "characters.types",
            "shared.entities",
            "actions.types",
            "combat.scaling",
            "skills.progression",
            "utils.logger"
         ],
         "notes": [
            "Core damage math for weapon, ability, spell, and song channels.",
            "Scales off STR/INT, level, weapon skill, spell school, or song instrument skill, with crit/glancing and rough armor/resist mitigation."
         ]
      },
      "combat.entityCombat": {
         "kind": "utility",
         "path": "worldcore/combat/entityCombat.ts",
         "functions": [
            "markInCombat",
            "killEntity",
            "isDeadEntity",
            "resurrectEntity",
            "applySimpleDamageToPlayer",
            "computeNpcMeleeDamage"
         ],
         "dependsOn": [
            "shared.entities"
         ],
         "notes": [
            "Shared entity HP helpers and NPC melee damage formula.",
            "Tags entities in combat, handles simple kill/resurrect, applies HP changes, and computes NPC melee hits from attackPower or a percentage of npc max HP."
         ]
      },
      "combat.npc": {
         "kind": "service",
         "path": "worldcore/combat/NpcCombat.ts",
         "functions": [
            "performNpcAttack",
            "applySimpleNpcCounterAttack",
            "announceSpawnToRoom",
            "scheduleNpcCorpseAndRespawn"
         ],
         "dependsOn": [
            "characters.types",
            "shared.entities",
            "utils.logger",
            "npc.types",
            "combat.entityCombat",
            "loot.text",
            "utils.random",
            "items.catalog",
            "items.inventoryHelpers",
            "combat.engine",
            "actions.types",
            "resources.power",
            "skills.progression",
            "mail.service",
            "characters.service",
            "npc.manager",
            "core.rooms"
         ],
         "notes": [
            "High-level NPC attack executor and death handling used by v1 brains.",
            "Uses CombatEngine for damage, updates skill and fury progression, applies counter-attacks, grants XP, rolls loot with overflow-to-mail, and schedules corpse/respawn with resource-node special-casing."
         ]
      },
      "combat.scaling": {
         "kind": "utility",
         "path": "worldcore/combat/CombatScaling.ts",
         "functions": [
            "getWeaponSkillLevel",
            "getSpellSchoolLevel"
         ],
         "dependsOn": [
            "skills.progression",
            "characters.types"
         ],
         "notes": [
            "Maps raw weapon/spell school skill into effective combat level.",
            "If no skill is recorded, falls back to character level; otherwise uses skill/5 with a minimum of 1."
         ]
      },
      "config.logconfig": {
         "kind": "config",
         "path": "worldcore/config/logconfig.ts",
         "functions": [
            "logEnabled"
         ],
         "notes": [
            "Log-level resolution for scoped loggers with global and per-scope env overrides.",
            "Used by Logger to decide if a given scope+level should emit output."
         ]
      },
      "config.runtime": {
         "kind": "config",
         "path": "worldcore/config/config.ts",
         "notes": [
            "Runtime server config: WS_HOST, WS_PORT, heartbeat interval and timeout.",
            "Values are derived from PW_WS_HOST and PW_WS_PORT env vars with safe defaults."
         ]
      },
      "config.shardConfig": {
         "kind": "config",
         "path": "worldcore/config/ShardConfig.ts",
         "notes": [
            "Shard-wide mode flag: 'dev' or 'live', driven by PW_SHARD_MODE env variable.",
            "Referenced by systems like item grant rules to gate dev-only behavior."
         ]
      },
      "config.worldscale": {
         "kind": "config",
         "path": "worldcore/config/worldscale.ts",
         "functions": [
            "getWorldScale"
         ],
         "notes": [
            "Defines dev_tiny, dev_medium, and live_prime world scales plus WORLD_SCALES registry.",
            "DEFAULT_WORLD_SCALE_ID is driven by PW_WORLD_SCALE; getWorldScale() returns the requested or default shard scale definition for worldgen, movement, and macro war sims."
         ]
      },
      "core.combat": {
         "kind": "engine",
         "path": "worldcore/core/CombatSystem.ts",
         "class": "CombatSystem",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.entities",
            "core.rooms",
            "core.sessions"
         ],
         "dependsOn": [
            "core.entities",
            "core.rooms",
            "core.sessions"
         ],
         "facade": "CombatFacade",
         "provides": [
            "setTarget(session, targetId?)",
            "handleCast(session, payload)"
         ],
         "eventsEmitted": [
            "target_set",
            "ability_cast"
         ],
         "notes": [
            "v1 safe stub: no real damage or aggro yet.",
            "Stashes targetId on player entity.",
            "Broadcasts 'target_set' and 'ability_cast' events to the room."
         ]
      },
      "core.entities": {
         "kind": "service",
         "path": "worldcore/core/EntityManager.ts",
         "class": "EntityManager",
         "lifecycle": "singleton",
         "ctorArgs": [],
         "dependsOn": [],
         "provides": [
            "createPlayerForSession(sessionId, roomId)",
            "createNpcEntity(roomId, model)",
            "get(entityId)",
            "getEntitiesInRoom(roomId)",
            "getEntityByOwner(sessionId)",
            "getAll()",
            "removeEntity(entityId)",
            "setPosition(entityId, x, y, z)"
         ],
         "notes": [
            "Single source of truth for all Entity records.",
            "Enforces one 'player' entity per session.",
            "NPCs are simple entities with type 'npc' and model."
         ]
      },
      "core.heartbeat": {
         "kind": "loop",
         "path": "worldcore/core/Heartbeat.ts",
         "function": "startHeartbeat",
         "lifecycle": "timer",
         "ctorArgs": [
            "core.sessions",
            "core.rooms",
            "config.heartbeat"
         ],
         "dependsOn": [
            "core.sessions",
            "core.rooms"
         ],
         "provides": [
            "startHeartbeat(sessions, rooms, cfg) -> NodeJS.Timeout"
         ],
         "notes": [
            "Periodic coarse idle session cleanup.",
            "Uses sessions.getAllSessions() and lastSeen for idle detection.",
            "Calls rooms.leaveRoom(session) before sessions.removeSession(sessionId)."
         ]
      },
      "core.movement": {
         "kind": "engine",
         "path": "worldcore/core/MovementEngine.ts",
         "class": "MovementEngine",
         "lifecycle": "singleton",
         "ctorArgs": [
            "world.manager"
         ],
         "dependsOn": [
            "world.manager"
         ],
         "facade": "MovementEngineFacade",
         "provides": [
            "applyClientMove(session, payload: ClientMovePayload) -> ResolvedMove|null"
         ],
         "notes": [
            "Validates client x/z/rotY.",
            "Samples heightmap for ground Y, keeps entity slightly above terrain.",
            "Logs when position is outside nominal world radius; world bounds enforcement is not strict yet."
         ]
      },
      "core.objectStream": {
         "kind": "service",
         "path": "worldcore/core/ObjectStream.ts",
         "class": "ObjectStream",
         "lifecycle": "singleton",
         "ctorArgs": [
            "world.manager",
            "core.sessions"
         ],
         "dependsOn": [
            "world.manager",
            "core.sessions"
         ],
         "facade": "ObjectStreamFacade",
         "provides": [
            "handleObjectRequest(session, payload)"
         ],
         "eventsEmitted": [
            "object_chunk"
         ],
         "notes": [
            "Static v1 object stream.",
            "Fetches shard blueprint via world.getShardBlueprint().",
            "Sends a single 'object_chunk' with all objects + spawns for now."
         ]
      },
      "core.rooms": {
         "kind": "service",
         "path": "worldcore/core/RoomManager.ts",
         "class": "RoomManager",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.sessions",
            "core.entities",
            "world.blueprints?"
         ],
         "dependsOn": [
            "core.sessions",
            "core.entities",
            "world.blueprints?"
         ],
         "provides": [
            "ensureRoom(roomId)",
            "get(roomId)",
            "listRooms()",
            "joinRoom(session, roomId)",
            "leaveRoom(session)"
         ],
         "notes": [
            "Creates Room instances on demand.",
            "Tracks which sessions are in which rooms.",
            "When joining a world room, fetches WorldBlueprint and sends 'world_blueprint' to that session."
         ],
         "eventsEmitted": [
            "world_blueprint",
            "room_joined",
            "room_left"
         ],
         "internalTypes": {
            "Room": {
               "path": "worldcore/core/Room.ts",
               "ctorArgs": [
                  "roomId",
                  "core.sessions",
                  "core.entities"
               ],
               "responsibilities": [
                  "Track membership for a room.",
                  "Create/ensure player entity when a character joins a world room.",
                  "Apply character position/name to entity before sending 'entity_list'.",
                  "Broadcast chat and entity updates to members.",
                  "Distinguish 'UI rooms' (lobby/auth/select_character) from world rooms."
               ],
               "eventsEmitted": [
                  "entity_list",
                  "chat",
                  "entity_update",
                  "ability_cast",
                  "target_set"
               ]
            }
         }
      },
      "core.router": {
         "kind": "gateway",
         "path": "worldcore/core/MessageRouter.ts",
         "class": "MessageRouter",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.sessions",
            "core.rooms",
            "core.entities",
            "core.movement?",
            "core.combat?",
            "core.objectStream?",
            "core.terrainStream?",
            "world.manager?",
            "guilds.service",
            "world.characters?",
            "world.items?",
            "world.npcs?",
            "world.mail?",
            "world.trades?",
            "world.vendors?",
            "world.bank?",
            "world.auctions?"
         ],
         "dependsOn": [
            "core.sessions",
            "core.rooms",
            "core.entities",
            "core.movement?",
            "core.combat?",
            "core.objectStream?",
            "core.terrainStream?",
            "world.manager?",
            "guilds.service",
            "world.characters?",
            "world.items?",
            "world.npcs?",
            "world.mail?",
            "world.trades?",
            "world.vendors?",
            "world.bank?",
            "world.auctions?"
         ],
         "handlesClientOps": [
            "ping / hello / heartbeat",
            "join_room / leave_room / list_rooms",
            "object_request",
            "terrain_request / terrain (envelope)",
            "move / walk / go",
            "action (attack, harvest)",
            "set_target / cast",
            "chat",
            "whereami",
            "mud",
            "gchat"
         ],
         "notes": [
            "Main entry point for all client->world traffic.",
            "Delegates movement to MovementEngineFacade, terrain/objects to streams, combat to CombatFacade.",
            "Builds a WorldActionContext bag for performAction and MudCommandHandler.",
            "Also exposes whereami resolution (roomId, pos, regionId, shardId) using both character and entity data."
         ]
      },
      "core.sessions": {
         "kind": "service",
         "path": "worldcore/core/SessionManager.ts",
         "class": "SessionManager",
         "lifecycle": "singleton",
         "ctorArgs": [],
         "dependsOn": [],
         "provides": [
            "createSession(socket, displayName)",
            "get(sessionId)",
            "getAllSessions()",
            "touch(sessionId)",
            "send(session, op, payload?)",
            "broadcast(op, payload?)"
         ],
         "notes": [
            "Owns all active sessions in memory.",
            "Tracks lastSeen for heartbeat idle timeout.",
            "Defaults shardId to 'prime_shard' on createSession."
         ]
      },
      "core.terrainStream": {
         "kind": "service",
         "path": "worldcore/core/TerrainStream.ts",
         "class": "TerrainStream",
         "lifecycle": "singleton",
         "ctorArgs": [
            "world.manager",
            "core.sessions"
         ],
         "dependsOn": [
            "world.manager",
            "core.sessions"
         ],
         "facade": "TerrainStreamFacade",
         "provides": [
            "handleChunkRequest(session, payload)",
            "handleTerrainEnvelope(session, payload)"
         ],
         "eventsEmitted": [
            "terrain"
         ],
         "notes": [
            "Samples heightmap around a center (x,z) into a small grid.",
            "Returns 'terrain' messages with kind 'simple_height_patch'.",
            "Envelope handler currently logs only; reserved for future streaming ops."
         ]
      },
      "core.tickEngine": {
         "kind": "engine",
         "path": "worldcore/core/TickEngine.ts",
         "class": "TickEngine",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.entities",
            "core.rooms",
            "core.sessions",
            "world.manager",
            "config.tick",
            "world.npcs?"
         ],
         "dependsOn": [
            "core.entities",
            "core.rooms",
            "core.sessions",
            "world.manager",
            "world.npcs?"
         ],
         "provides": [
            "start()",
            "stop()"
         ],
         "notes": [
            "Fixed-interval tick loop (min 10ms).",
            "Ticks NPCs via NpcManager.updateAll each tick (if provided).",
            "Calls cfg.onTick(now, tick, deltaMs) hook for systems like SongEngine.",
            "Logs basic stats periodically."
         ]
      },
      "interaction.ops": {
         "kind": "service",
         "path": "worldcore/interaction/interactOps.ts",
         "functions": [
            "interactInRoom"
         ],
         "dependsOn": [
            "targeting.finders"
         ],
         "notes": [
            "Handles 'interact <what>' / 'use <what>' style interactions in the current room.",
            "Resolves NPC target by name and returns flavored text, with optional quest-log-based hints."
         ]
      },
      "items.catalog": {
         "kind": "model",
         "path": "worldcore/items/ItemCatalog.ts",
         "functions": [
            "getItemTemplate",
            "listAllItems"
         ],
         "dependsOn": [
            "items.types"
         ],
         "notes": [
            "Static built-in item templates for starter gear, rat loot, and basic ore.",
            "Used as a fallback when DB-backed items are missing."
         ]
      },
      "items.config": {
         "kind": "config",
         "path": "worldcore/items/ItemConfig.ts",
         "notes": [
            "Item-related runtime config; currently defines defaultOverflowPolicy used by ItemService."
         ]
      },
      "items.display": {
         "kind": "service",
         "path": "worldcore/items/ItemDisplay.ts",
         "functions": [
            "formatItemLabel",
            "formatItemDefinition",
            "formatItemTemplate",
            "getItemRarityColorCode",
            "getItemTooltip"
         ],
         "dependsOn": [
            "items.service",
            "items.catalog",
            "items.types",
            "utils.colors"
         ],
         "notes": [
            "Builds human-readable labels and tooltips from DB-backed items or static templates.",
            "Maps item rarity to ANSI color codes for console output."
         ]
      },
      "items.economy": {
         "kind": "service",
         "path": "worldcore/items/ItemEconomy.ts",
         "functions": [
            "getItemSellValue"
         ],
         "dependsOn": [
            "items.catalog"
         ],
         "notes": [
            "Computes base vendor sell value for an item in gold based on template.baseValue.",
            "Returns 0 for unsellable or unknown items."
         ]
      },
      "items.equipmentOps": {
         "kind": "service",
         "path": "worldcore/items/equipmentOps.ts",
         "functions": [
            "equipFirstMatchingFromBags",
            "unequipToBags"
         ],
         "dependsOn": [
            "utils.logger",
            "items.catalog",
            "items.inventoryHelpers",
            "mail.service?",
            "characters.service?"
         ],
         "notes": [
            "High-level equipment swap logic operating on character.inventory and equipment.",
            "Handles bag overflow by mailing items when possible, or rejecting unequip if no space/mail."
         ]
      },
      "items.grantRules": {
         "kind": "service",
         "path": "worldcore/items/ItemGrantRules.ts",
         "functions": [
            "canGrantItemToPlayer"
         ],
         "dependsOn": [
            "auth.staffRoles",
            "config.shardConfig",
            "items.types"
         ],
         "notes": [
            "Enforces staff role and shard mode rules for granting items to players.",
            "Blocks low-ranked staff or dev-only items on live shards unless actor role is high enough."
         ]
      },
      "items.inventoryConsume": {
         "kind": "utility",
         "path": "worldcore/items/inventoryConsume.ts",
         "functions": [
            "countItemInInventory",
            "consumeItemFromInventory",
            "canConsumeRecipe",
            "consumeRecipe"
         ],
         "dependsOn": [
            "characters.types"
         ],
         "notes": [
            "Counts and consumes items in inventory across all bags.",
            "Provides helpers to check and consume crafting recipe inputs for a given count."
         ]
      },
      "items.inventoryHelpers": {
         "kind": "utility",
         "path": "worldcore/items/InventoryHelpers.ts",
         "functions": [
            "findFreeBagSlot",
            "addItemToInventory",
            "addItemToBags",
            "addCurrency",
            "getCurrency",
            "setCurrency",
            "getGold",
            "setGold"
         ],
         "dependsOn": [
            "characters.types"
         ],
         "notes": [
            "Core bag and currency helpers operating on InventoryState.",
            "addItemToBags performs stack-aware item addition; addItemToInventory is a deprecated simple helper."
         ]
      },
      "items.inventoryRemove": {
         "kind": "utility",
         "path": "worldcore/items/InventoryRemove.ts",
         "functions": [
            "removeItemFromBags"
         ],
         "dependsOn": [
            "characters.types"
         ],
         "notes": [
            "Removes up to a given quantity of an item from all bags in-place.",
            "Returns how many were removed vs leftover."
         ]
      },
      "items.inventoryTest": {
         "kind": "dev_script",
         "path": "worldcore/items/InventoryTest.ts",
         "notes": [
            "Standalone Node script to sanity-check ItemService + inventory add/remove behavior.",
            "Uses defaultInventory(), adds huge stacks, then removes items and logs bag state."
         ]
      },
      "items.inventoryView": {
         "kind": "service",
         "path": "worldcore/items/inventoryView.ts",
         "functions": [
            "buildInventoryLines"
         ],
         "dependsOn": [
            "items.display"
         ],
         "notes": [
            "Builds text lines describing currency and bag contents using formatted item labels.",
            "Used by the 'inventory' command to render a readable inventory view."
         ]
      },
      "items.overflowPolicy": {
         "kind": "types",
         "path": "worldcore/items/OverflowPolicy.ts",
         "notes": [
            "String union type for overflow behavior: 'drop', 'destroy', or 'mail'.",
            "Used by ItemService.addToInventory to decide how to handle leftover quantities."
         ]
      },
      "items.resolve": {
         "kind": "service",
         "path": "worldcore/items/resolveItem.ts",
         "functions": [
            "resolveItem"
         ],
         "dependsOn": [
            "items.service",
            "items.catalog",
            "items.types"
         ],
         "notes": [
            "Resolves an itemId to a runtime template using DB-backed ItemService first, then static ItemCatalog.",
            "Normalizes category/baseValue fields when pulling from DB."
         ]
      },
      "items.resolvedItem": {
         "kind": "model",
         "path": "worldcore/items/ResolvedItem.ts",
         "notes": [
            "Unified runtime item type combining DB-backed definitions and static templates.",
            "Suitable for inventories, loot drops, and gameplay without caring about source."
         ]
      },
      "items.service": {
         "kind": "service",
         "path": "worldcore/items/ItemService.ts",
         "class": "ItemService",
         "functions": [
            "loadAll",
            "ensureLoaded",
            "get",
            "has",
            "findByIdOrName",
            "listAll",
            "listByCategory",
            "addToInventory",
            "removeFromInventory"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "items.types",
            "characters.types",
            "items.inventoryHelpers",
            "items.inventoryRemove",
            "items.config",
            "items.overflowPolicy"
         ],
         "notes": [
            "Postgres-backed item definition cache and inventory mutation helper.",
            "Adds items with stack logic and handles overflow via destroy/mail/drop policies."
         ]
      },
      "items.types": {
         "kind": "model",
         "path": "worldcore/items/ItemTypes.ts",
         "functions": [
            "rowToItemDefinition"
         ],
         "notes": [
            "Defines ItemTemplate, ItemDefinition, ItemRow, ItemRarity, and EQUIP_SLOTS/EquipSlot.",
            "rowToItemDefinition converts Postgres rows into runtime ItemDefinition objects."
         ]
      },
      "loot.text": {
         "kind": "service",
         "path": "worldcore/loot/lootText.ts",
         "functions": [
            "describeLootLine"
         ],
         "notes": [
            "Formats a single loot line like '2x Rat Tail' or 'Rat Tail' based on quantity and optional display name.",
            "Clamps qty to >= 0 and falls back to the itemId when itemName is not provided."
         ]
      },
      "mail.postgres": {
         "kind": "service",
         "path": "worldcore/mail/PostgresMailService.ts",
         "class": "PostgresMailService",
         "dependsOn": [
            "db.main",
            "utils.logger",
            "mail.types",
            "mail.service",
            "economy.helpers"
         ],
         "notes": [
            "Postgres-backed implementation of MailService using mailboxes, mails, and mail_items tables.",
            "Supports system mail with JSONB metadata and attachment claiming via giveItemsToCharacter."
         ]
      },
      "mail.service": {
         "kind": "service_contract",
         "path": "worldcore/mail/MailService.ts",
         "notes": [
            "MailService interface: getOrCreateMailbox, listMail, getMail, markRead, sendSystemMail, claimAttachments.",
            "claimAttachments moves items into a character's inventory and reports claimed vs leftover counts."
         ]
      },
      "mail.types": {
         "kind": "model",
         "path": "worldcore/mail/MailTypes.ts",
         "notes": [
            "Defines MailOwnerKind ('account'|'character'), MailAttachment, MailSummary, and MailDetail.",
            "MailSummary carries read/hasAttachments flags; MailDetail adds body and attachments."
         ]
      },
      "movement.commands": {
         "kind": "service",
         "path": "worldcore/movement/MovementCommands.ts",
         "functions": [
            "parseMoveDir",
            "tryMoveCharacter"
         ],
         "dependsOn": [
            "world.manager"
         ],
         "notes": [
            "Parses movement directions like 'n', 'north', 'sw', 'southwest' into MoveDir.",
            "tryMoveCharacter applies server-authoritative X/Z movement and rejects steps that leave the world/region."
         ]
      },
      "movement.ops": {
         "kind": "service",
         "path": "worldcore/movement/moveOps.ts",
         "functions": [
            "moveCharacterAndSync"
         ],
         "dependsOn": [
            "movement.commands",
            "utils.logger",
            "core.entities",
            "characters.service?"
         ],
         "notes": [
            "High-level movement op that calls tryMoveCharacter, syncs the entity position, and best-effort persists the character position.",
            "Uses a MoveOpsContext with session/entities/characters to avoid hard coupling to full services."
         ]
      },
      "mud.abilities": {
         "kind": "service",
         "path": "worldcore/mud/MudAbilities.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "abilities.table",
            "resources.power",
            "combat.cooldowns",
            "mud.actions.combat",
            "mud.helpers"
         ],
         "provides": [
            "handleAbilityCommand(ctx:MudContext, char:CharacterState, abilityName:string, targetName?:string):Promise<string>",
            "listKnownAbilitiesForChar(char:CharacterState):AbilityDefinition[]"
         ],
         "notes": [
            "Implements 'abilities' and 'ability <name> [target]'.",
            "Gates by class/level/cooldown/resource, then delegates actual damage to performNpcAttack."
         ]
      },
      "mud.actions": {
         "kind": "facade",
         "path": "worldcore/mud/MudActions.ts",
         "dependsOn": [
            "mud.actions.combat",
            "mud.actions.recovery",
            "mud.actions.world"
         ],
         "notes": [
            "Re-export hub for MUD actions.",
            "Older imports from '../MudActions' stay valid while we refactor call sites."
         ]
      },
      "mud.actions.combat": {
         "kind": "service",
         "path": "worldcore/mud/actions/MudCombatActions.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "combat.npc",
            "mud.trainingDummy",
            "mud.progressionHooks",
            "progression.core",
            "mud.helpers"
         ],
         "provides": [
            "performNpcAttack(ctx, char, selfEntity, npc, opts?):Promise<string>",
            "scheduleNpcCorpseAndRespawn(ctx, npcEntityId):void",
            "announceSpawnToRoom(ctx, roomId, text):void",
            "handleAttackAction(ctx, char, targetNameRaw):Promise<string>"
         ],
         "notes": [
            "Preferred combat action module for 'attack' and shared action pipeline.",
            "Thin wrapper over shared NpcCombat module plus training dummy integration."
         ]
      },
      "mud.actions.legacy": {
         "kind": "legacy_service",
         "path": "worldcore/mud/MudActions.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "core.entities",
            "core.rooms",
            "world.manager",
            "world.npcs?",
            "items.service?",
            "progression.core",
            "mud.progressionHooks",
            "mud.trainingDummy",
            "mud.helpers",
            "resources.power?",
            "skills.progression?",
            "world.respawns?"
         ],
         "provides": [
            "performNpcAttack(ctx, char, selfEntity, npc, opts?)",
            "handleAttackAction(ctx, char, targetNameRaw)",
            "handleGatherAction(ctx, char, targetNameRaw, gatheringKind, resourceTag)",
            "scheduleNpcCorpseAndRespawn(ctx, npcEntityId)",
            "announceSpawnToRoom(ctx, roomId, text)"
         ],
         "notes": [
            "Older monolithic MUD action set; being replaced by mud.actions.combat and mud.actions.world.",
            "Still referenced by some modules; refactor target once new actions are fully wired."
         ]
      },
      "mud.actions.recovery": {
         "kind": "service",
         "path": "worldcore/mud/actions/MudRecoveryActions.ts",
         "lifecycle": "stateless",
         "dependsOn": [],
         "provides": [],
         "notes": [
            "Reserved for future rest/sleep/recovery commands; currently an empty module."
         ]
      },
      "mud.actions.world": {
         "kind": "service",
         "path": "worldcore/mud/actions/MudWorldActions.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "world.npcs",
            "core.entities",
            "world.manager",
            "items.service?",
            "progression.core",
            "mud.progressionHooks",
            "mud.helpers"
         ],
         "provides": [
            "handleGatherAction(ctx, char, targetNameRaw, gatheringKind, resourceTag):Promise<string>"
         ],
         "notes": [
            "Implements 'harvest' actions (mining/herbalism/etc.).",
            "Handles node validation, loot rolls, depletion timestamps, and node/NPC despawn."
         ]
      },
      "mud.autoattack": {
         "kind": "service",
         "path": "worldcore/mud/commands/combat/autoattack/trainingDummyAutoAttack.ts",
         "functions": [
            "startTrainingDummyAutoAttack",
            "stopAutoAttack"
         ],
         "dependsOn": [
            "mud.context",
            "core.sessions",
            "core.entities",
            "characters.stats",
            "combat.entityCombat",
            "utils.logger"
         ],
         "notes": [
            "Manages per-session autoattack timers and interactions with the Training Dummy.",
            "Uses character effective attributes and entity health to simulate periodic swings."
         ]
      },
      "mud.commands.bank": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/bankCommand.ts",
         "function": "handleBankCommand",
         "dependsOn": [
            "mud.context",
            "bank.ops",
            "items.service",
            "core.sessions?"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Front-end for banking operations (deposit/withdraw/etc.).",
            "Chooses owner as account vs character based on session identity."
         ]
      },
      "mud.commands.combat.ability": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/combat/abilityCommand.ts",
         "function": "handleAbilityMudCommand",
         "dependsOn": [
            "mud.context",
            "mud.abilities"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'ability <name> [target]'.",
            "Delegates validation and execution to MudAbilities.handleAbilityCommand."
         ]
      },
      "mud.commands.combat.attack": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/combat/attackCommand.ts",
         "function": "handleAttackCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.combat"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'attack <target>'.",
            "Parses targetNameRaw and routes to handleAttackAction."
         ]
      },
      "mud.commands.combat.autoattack": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/combat/autoAttackCommand.ts",
         "function": "handleAutoAttackCommand",
         "dependsOn": [
            "mud.context",
            "mud.autoattack",
            "mud.trainingDummy"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'autoattack [on|off]'.",
            "Looks up TrainingDummyDeps from input.services.trainingDummy and toggles autoattack on/off."
         ]
      },
      "mud.commands.combat.cast": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/combat/castCommand.ts",
         "function": "handleCastMudCommand",
         "dependsOn": [
            "mud.context",
            "mud.spells"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'cast <name> [target]'.",
            "Delegates to MudSpells.handleCastCommand for spell gating + effects."
         ]
      },
      "mud.commands.craft": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/craftCommand.ts",
         "function": "handleCraftCommand",
         "dependsOn": [
            "mud.context",
            "items.service",
            "characters.service",
            "mail.service",
            "tradeskills.recipes",
            "mud.progression"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'craft', 'craft list', and 'craft <id|name> [count]'.",
            "Checks recipe inputs/outputs exist, consumes ingredients, adds outputs (bags + mail overflow),",
            "and records action progress for tasks/quests."
         ]
      },
      "mud.commands.debug.handlers": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/debug/handlers.ts",
         "functions": [
            "handleDebugGive",
            "handleDebugXp",
            "handleDebugSpawnNpc",
            "handleDebugSpawnRat",
            "handleDebugSpawnOre",
            "handleDebugSpawnsHere",
            "handleEventGiveAny",
            "handleEventMailReward",
            "handleDebugGiveMat",
            "handleDebugResetLevel",
            "handleDebugHurt"
         ],
         "dependsOn": [
            "mud.context",
            "utils.logger",
            "auth.staffAudit",
            "auth.staffRole",
            "auth.debugGate?",
            "items.service",
            "characters.service",
            "mail.service",
            "npc.service",
            "npc.types",
            "npc.spawnController",
            "world.spawnPoints",
            "core.entities",
            "combat.entityCombat",
            "ai.npc.localBrain"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Collection of staff/debug/event commands (debug_give, debug_xp, debug_spawn_npc, event_give_any, etc.).",
            "Many of these should be wrapped with withDebugGate before being exposed to normal command routing."
         ]
      },
      "mud.commands.debug.withDebugGate": {
         "kind": "utility",
         "path": "worldcore/mud/commands/debug/withDebugGate.ts",
         "function": "withDebugGate",
         "dependsOn": [
            "auth.debugGate"
         ],
         "notes": [
            "Higher-order helper that wraps a debug handler and enforces requireDebug(ctx, minRole).",
            "Defaults to minRole='dev'; returns a handler with the same (ctx,char,input) signature."
         ]
      },
      "mud.commands.economy.auction": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/economy/auctionCommand.ts",
         "function": "handleAuctionCommand",
         "dependsOn": [
            "mud.context",
            "auction.service",
            "items.service",
            "characters.service",
            "mail.service",
            "economy.gold",
            "auction.auditLog",
            "auction.format"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'ah' / auction house commands: browse, sell, buy, my, claim, cancel, expire, reclaim.",
            "Handles bag removal, proceeds claim, and overflow via mail."
         ]
      },
      "mud.commands.economy.trade": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/economy/tradeCommand.ts",
         "function": "handleTradeCommand",
         "dependsOn": [
            "mud.context",
            "trade.service",
            "economy.gold",
            "core.sessions",
            "mud.sessions.lookup"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'trade' flow: with/start, show/status, additem, addgold, clear, confirm, cancel.",
            "Uses tradeOps.finalizeTrade and sessionLookup helpers to find other player sessions."
         ]
      },
      "mud.commands.economy.vendor": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/economy/vendorCommand.ts",
         "function": "handleVendorCommand",
         "dependsOn": [
            "mud.context",
            "vendor.service",
            "items.service",
            "characters.service",
            "mail.service",
            "economy.gold"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'vendor list <id>' and 'vendor buy <id> <index> [qty]'.",
            "Charges only for items that actually land in bags/mail; handles overflow via system mail."
         ]
      },
      "mud.commands.gathering.farming": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/farmingCommand.ts",
         "function": "handleFarmingCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Currently wired identically to mining (mining/resource_ore) \u2013 copy-paste placeholder.",
            "Conceptually represents 'farming' gather actions; future refactor will adjust resource tags."
         ]
      },
      "mud.commands.gathering.fishing": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/fishingCommand.ts",
         "function": "handleFishingCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Same as farming for now: delegates to handleGatherAction with mining/resource_ore.",
            "Placeholder for true fishing logic (water validation, fish loot tables, etc.)."
         ]
      },
      "mud.commands.gathering.lumbering": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/lumberingCommand.ts",
         "function": "handleLumberingCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Also currently uses mining/resource_ore; intended to become woodcutting in a later pass."
         ]
      },
      "mud.commands.gathering.mining": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/miningCommand.ts",
         "function": "handleMiningCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'mine <target>'.",
            "Delegates to handleGatherAction(ctx, char, targetNameRaw, 'mining', 'resource_ore')."
         ]
      },
      "mud.commands.gathering.picking": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/pickingCommand.ts",
         "function": "handlePickingCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'pick <target>'.",
            "Delegates to handleGatherAction(ctx, char, targetNameRaw, 'herbalism', 'resource_herb')."
         ]
      },
      "mud.commands.gathering.quarrying": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/gathering/quarryingCommand.ts",
         "function": "handleQuarryingCommand",
         "dependsOn": [
            "mud.context",
            "mud.actions",
            "mud.actions.world"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'quarry <target>'.",
            "Delegates to handleGatherAction(ctx, char, targetNameRaw, 'mining', 'resource_ore')."
         ]
      },
      "mud.commands.guildBank": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/guildBankCommand.ts",
         "function": "handleGuildBankCommand",
         "dependsOn": [
            "mud.context",
            "bank.ops",
            "items.service",
            "guilds.service?"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Front-end for guild bank operations.",
            "Uses bankOps.handleBankCommand with ownerKind='guild' based on char.guildId."
         ]
      },
      "mud.commands.meta.help": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/meta/helpCommand.ts",
         "function": "handleHelpCommand",
         "dependsOn": [
            "mud.help",
            "auth.staffRole"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Emits 'Available commands' list using HELP_ENTRIES.",
            "Includes debug-only commands only if staff role is owner/dev/gm."
         ]
      },
      "mud.commands.player.abilities": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/abilitiesCommand.ts",
         "function": "handleAbilitiesCommand",
         "dependsOn": [
            "mud.abilities"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'abilities'.",
            "Lists known abilities for the current character via MudAbilities.listKnownAbilitiesForChar."
         ]
      },
      "mud.commands.player.equipment": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/equipmentCommand.ts",
         "functions": [
            "handleEquipCommand",
            "handleUnequipCommand"
         ],
         "dependsOn": [
            "items.equipmentOps",
            "mud.context"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'equip <slot>' and 'unequip <slot>'.",
            "Uses equipFirstMatchingFromBags and unequipToBags."
         ]
      },
      "mud.commands.player.inventory": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/inventoryCommand.ts",
         "function": "handleInventoryCommand",
         "dependsOn": [
            "items.inventoryView",
            "mud.context"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'inventory' / 'inv'.",
            "Renders inventory using buildInventoryLines and joins lines with newlines."
         ]
      },
      "mud.commands.player.itemInfo": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/itemInfoCommand.ts",
         "function": "handleItemInfoCommand",
         "dependsOn": [
            "items.display",
            "mud.context"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'iteminfo <token>'.",
            "Uses getItemTooltip to render item label, lines, and rarity, or reports no item found."
         ]
      },
      "mud.commands.player.melody": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/melodyCommand.ts",
         "function": "handleMelodyCommand",
         "dependsOn": [
            "mud.context",
            "songs.engine",
            "spells.table"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'melody' meta-command for Virtuoso.",
            "Supports subcommands: add, remove, clear, start, stop; manages song queues via SongEngine."
         ]
      },
      "mud.commands.player.recovery": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/player/recoveryCommand.ts",
         "functions": [
            "handleRespawnCommand",
            "handleRestCommand"
         ],
         "dependsOn": [
            "mud.context",
            "world.respawns?",
            "core.entities",
            "systems.recovery",
            "mud.autoattack",
            "mud.trainingDummy",
            "resources.power"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'respawn' and 'rest'.",
            "Respawn uses RespawnService when available, falling back to local respawnInPlace.",
            "Rest uses recoveryOps and also restores mana/fury via PowerResources."
         ]
      },
      "mud.commands.player.resources": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/resourcesCommand.ts",
         "function": "handleResourcesCommand",
         "dependsOn": [
            "resources.power"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'resources'.",
            "Shows primary resource pool (Fury or Mana) and optional secondary pool for Adventurer."
         ]
      },
      "mud.commands.player.skills": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/skillsCommand.ts",
         "function": "handleSkillsCommand",
         "dependsOn": [
            "mud.context",
            "skills.progression"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'skills'.",
            "Shows weapon skills, spell schools (except for pure-song classes like Virtuoso), and song schools."
         ]
      },
      "mud.commands.player.songs": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/songsCommand.ts",
         "function": "handleSongsCommand",
         "dependsOn": [
            "mud.context",
            "spells.table"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'songs'.",
            "Lists non-hidden songs (isSong=true) that match class or 'any' and are <= character level."
         ]
      },
      "mud.commands.player.spells": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/spellsCommand.ts",
         "function": "handleSpellsCommand",
         "dependsOn": [
            "mud.context",
            "spells.table"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'spells'.",
            "Lists non-song spells for the character's class (or 'any') that meet min level."
         ]
      },
      "mud.commands.player.stats": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/player/statsCommand.ts",
         "function": "handleStatsCommand",
         "dependsOn": [
            "mud.context",
            "characters.sheet",
            "mud.progression",
            "characters.titles"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'stats'.",
            "Builds character sheet line including gear and active title using buildCharacterSheetLine."
         ]
      },
      "mud.commands.progression.progress": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/progression/progressCommand.ts",
         "function": "handleProgressCommand",
         "dependsOn": [
            "progression.progressText"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'progress'.",
            "Uses renderProgressText(char) to show progression counters."
         ]
      },
      "mud.commands.progression.quests": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/progression/questsCommand.ts",
         "functions": [
            "handleQuestsCommand",
            "handleQuestCommand"
         ],
         "dependsOn": [
            "mud.progression",
            "quests.turnIn"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'quests' and 'quest ...' commands.",
            "Default shows quest log; subcommand 'turnin'/'turn-in'/'complete' turns in a quest by target string."
         ]
      },
      "mud.commands.progression.titles": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/progression/titlesCommand.ts",
         "functions": [
            "handleTitleCommand",
            "handleTitlesCommand",
            "handleSetTitleCommand"
         ],
         "dependsOn": [
            "progression.titles.text",
            "progression.titles.setActive"
         ],
         "invokedBy": [
            "mud.handler"
         ],
         "notes": [
            "Implements 'title', 'titles', and 'settitle ...'.",
            "Renders current title, lists available titles, and sets active title based on fuzzy input."
         ]
      },
      "mud.commands.registry": {
         "kind": "registry",
         "path": "worldcore/mud/commands/registry.ts",
         "dependsOn": [
            "mud.commands.bank",
            "mud.commands.guildBank",
            "mud.commands.economy.trade",
            "mud.commands.economy.vendor",
            "mud.commands.economy.auction",
            "mud.commands.social.mail",
            "mud.commands.craft",
            "mud.commands.world.look",
            "mud.commands.world.examine",
            "mud.commands.world.inspectRegion",
            "mud.commands.world.nearby",
            "mud.commands.world.map",
            "mud.commands.world.save",
            "mud.commands.world.move",
            "mud.commands.world.interact",
            "mud.commands.world.talk",
            "mud.commands.social.chat",
            "mud.commands.social.guildChat",
            "mud.commands.social.who",
            "mud.commands.meta.help",
            "mud.commands.player.inventory",
            "mud.commands.player.itemInfo",
            "mud.commands.player.equipment",
            "mud.commands.player.stats",
            "mud.commands.player.recovery",
            "mud.commands.player.resources",
            "mud.commands.player.skills",
            "mud.commands.player.melody",
            "mud.commands.player.abilities",
            "mud.commands.player.songs",
            "mud.commands.player.spells",
            "mud.commands.combat.cast",
            "mud.commands.combat.ability",
            "mud.commands.combat.attack",
            "mud.commands.combat.autoattack",
            "mud.commands.gathering.picking",
            "mud.commands.gathering.mining",
            "mud.commands.gathering.quarrying",
            "mud.commands.progression.quests",
            "mud.commands.progression.progress",
            "mud.commands.progression.titles",
            "mud.commands.debug.handlers",
            "mud.commands.debug.withDebugGate"
         ],
         "notes": [
            "Maps text commands (bank, move, cast, etc.) to specific handler functions.",
            "Central router used by MudCommandHandler to dispatch player commands."
         ]
      },
      "mud.commands.sessionLookup": {
         "kind": "utility",
         "path": "worldcore/mud/commands/sessionLookup.ts",
         "functions": [
            "findSessionByCharacterNameInRoom",
            "findSessionByCharacterId"
         ],
         "dependsOn": [
            "core.sessions"
         ],
         "notes": [
            "Helpers to resolve sessions by character id or name in a room.",
            "Used by commands that need to target other players."
         ]
      },
      "mud.commands.social.chat": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/social/chatCommand.ts",
         "functions": [
            "handleSayCommand",
            "handleTellCommand"
         ],
         "dependsOn": [
            "mud.context",
            "core.sessions",
            "core.rooms?"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'say' and 'tell' chat commands.",
            "Broadcasts room chat via room.broadcast where possible, falls back to iterating sessions."
         ]
      },
      "mud.commands.social.guildChat": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/social/guildChatCommand.ts",
         "function": "handleGuildChatCommand",
         "dependsOn": [
            "mud.context",
            "guilds.service",
            "core.sessions"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'gchat'.",
            "Fetches guild for character, hydrates char.guildId, and broadcasts messages to all guild members online."
         ]
      },
      "mud.commands.social.mail": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/social/mailCommand.ts",
         "function": "handleMailCommand",
         "dependsOn": [
            "mail.service",
            "items.service",
            "characters.service",
            "auth.staffRole",
            "auth.staffAudit"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'mail [list|read|claim|event_reward]'.",
            "Player-facing mailbox plus staff-only event_reward helper."
         ]
      },
      "mud.commands.social.who": {
         "kind": "mud_command_group",
         "path": "worldcore/mud/commands/social/whoCommand.ts",
         "functions": [
            "handleWhoCommand",
            "handleWhoAllCommand",
            "handleWhoIsCommand"
         ],
         "dependsOn": [
            "core.sessions",
            "world.regionText"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'who', 'whoall', and 'whois'.",
            "Lists visible players in room, all online players, or detailed info for a single character."
         ]
      },
      "mud.commands.types": {
         "kind": "types",
         "path": "worldcore/mud/commands/types.ts",
         "notes": [
            "Defines MudCommandInput, MudServices, and MudCommandHandlerFn.",
            "Used by command modules and the central registry for typing."
         ]
      },
      "mud.commands.world.examine": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/examineCommand.ts",
         "function": "handleExamineCommand",
         "dependsOn": [
            "mud.context",
            "core.entities",
            "npc.types",
            "npc.state",
            "target.finders"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'examine <target>'.",
            "Shows level, HP, and tags for NPCs/resources like ore veins and rats; falls back if nothing matches."
         ]
      },
      "mud.commands.world.examineRegion": {
         "kind": "alias",
         "path": "worldcore/mud/commands/world/inspectRegionCommand.ts",
         "notes": [
            "Alias entry kept separate in case you introduce alternate region inspection commands later."
         ]
      },
      "mud.commands.world.inspect": {
         "kind": "alias",
         "path": "worldcore/mud/commands/world/examineCommand.ts",
         "notes": [
            "Optional alias placeholder for future 'inspect' behavior."
         ]
      },
      "mud.commands.world.inspectRegion": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/inspectRegionCommand.ts",
         "function": "handleInspectRegionCommand",
         "dependsOn": [
            "world.manager",
            "world.spawnPoints"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Developer-facing region inspector (supports optional 'inspect_region <x> <z>' / comma forms).",
            "Prints region identity + sampling info when available.",
            "Also queries DB spawn_points: counts spawns in the region and near the query point (radius=10), and prints a short list."
         ]
      },
      "mud.commands.world.interact": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/interactCommand.ts",
         "function": "handleInteractCommand",
         "dependsOn": [
            "interaction.ops",
            "mud.progression"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'interact <what>' and 'use <what>'.",
            "Routes to interactInRoom with quest-log rendering for feedback."
         ]
      },
      "mud.commands.world.look": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/lookCommand.ts",
         "function": "handleLookCommand",
         "dependsOn": [
            "mud.context",
            "core.entities",
            "world.manager"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'look'.",
            "Describes current region and nearby NPCs in the same room with HP readouts."
         ]
      },
      "mud.commands.world.map": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/mapCommand.ts",
         "function": "handleMapCommand",
         "dependsOn": [
            "mud.mapRenderer",
            "world.manager"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'map [radius]'.",
            "Calls buildAsciiMap(world, char, radius) for ANSI map output."
         ]
      },
      "mud.commands.world.move": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/moveCommand.ts",
         "function": "handleMoveCommand",
         "dependsOn": [
            "movement.ops",
            "movement.commands",
            "world.manager"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'move', 'walk', and 'go'.",
            "Parses direction, calls moveCharacterAndSync, and returns movement text or failure reason."
         ]
      },
      "mud.commands.world.nearby": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/nearbyCommand.ts",
         "function": "handleNearbyCommand",
         "dependsOn": [
            "mud.context",
            "core.entities",
            "npc.spawns"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'nearby'.",
            "Refreshes personal nodes, then lists nearby entities within radius with short handles like rat.1."
         ]
      },
      "mud.commands.world.save": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/saveCommand.ts",
         "function": "handleSaveCommand",
         "dependsOn": [
            "characters.service",
            "auth.identity",
            "utils.logger"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'save'.",
            "Patch-updates the character record with position, attributes, inventory, equipment, spellbook, abilities, and progression."
         ]
      },
      "mud.commands.world.talk": {
         "kind": "mud_command",
         "path": "worldcore/mud/commands/world/talkCommand.ts",
         "function": "handleTalkCommand",
         "dependsOn": [
            "mud.context",
            "core.entities",
            "npc.types",
            "npc.state",
            "target.finders",
            "progression.core",
            "mud.progression"
         ],
         "invokedBy": [
            "mud.handler",
            "mud.commands.registry"
         ],
         "notes": [
            "Implements 'talk <npc>'.",
            "Finds an NPC in the room, fires a talk_to progression event, runs hooks, and prints any progression snippets."
         ]
      },
      "mud.context": {
         "kind": "model",
         "path": "worldcore/mud/MudContext.ts",
         "types": [
            "MudContext"
         ],
         "dependsOn": [
            "core.sessions",
            "guilds.service",
            "world.manager?",
            "world.characters?",
            "core.entities?",
            "core.rooms?",
            "world.npcs?",
            "world.trades?",
            "world.vendors?",
            "world.bank?",
            "world.auctions?",
            "world.mail?",
            "world.respawns?"
         ],
         "notes": [
            "Shared dependency bag for all MUD handlers (commands, actions, progression).",
            "Threaded from MessageRouter for each incoming 'mud' command."
         ]
      },
      "mud.handler": {
         "kind": "gateway",
         "path": "worldcore/mud/MudCommandHandler.ts",
         "class": "MudCommandHandler",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "mud.map",
            "mud.abilities",
            "mud.spells",
            "mud.actions.combat",
            "mud.actions.world",
            "mud.progression",
            "mud.progressionHooks",
            "mud.help",
            "mud.presence",
            "core.sessions",
            "core.rooms",
            "world.manager?",
            "world.query?",
            "world.events?"
         ],
         "handlesCommandsFromHelp": true,
         "notes": [
            "Parses MUD command lines and routes them to the appropriate action/utility.",
            "Commands roughly correspond 1:1 to HELP_ENTRIES in MudHelpMenu.ts."
         ]
      },
      "mud.help": {
         "kind": "utility",
         "path": "worldcore/mud/MudHelpMenu.ts",
         "symbol": "HELP_ENTRIES",
         "dependsOn": [],
         "provides": [
            "HELP_ENTRIES: { cmd:string, desc:string, debug?:boolean }[]"
         ],
         "notes": [
            "Source of truth for the MUD help text and visible commands."
         ]
      },
      "mud.helpers": {
         "kind": "legacy_facade",
         "path": "worldcore/mud/MudHelperFunctions.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "loot.text",
            "utils.random",
            "combat.entityCombat",
            "targeting.finders",
            "systems.regen",
            "world.regionText"
         ],
         "provides": [
            "describeLootLine",
            "rollInt",
            "grantTaskRewards",
            "markInCombat",
            "killEntity",
            "isDeadEntity",
            "resurrectEntity",
            "applySimpleDamageToPlayer",
            "computeNpcMeleeDamage",
            "findTargetPlayerEntityByName",
            "findNearestNpcByName",
            "findNpcTargetByName",
            "ensureRegenLoop",
            "formatRegionLabel",
            "prettyRegionName"
         ],
         "notes": [
            "Transitional re-export hub; file header explicitly warns it is being dismantled.",
            "New code should import helpers directly from their home modules instead."
         ]
      },
      "mud.map": {
         "kind": "utility",
         "path": "worldcore/mud/MapRenderer.ts",
         "function": "buildAsciiMap",
         "dependsOn": [
            "world.manager"
         ],
         "provides": [
            "buildAsciiMap(world:ServerWorldManager|undefined, char:CharacterState, radius?:number):string"
         ],
         "notes": [
            "Builds ANSI-friendly minimap strings using RegionMap biomes.",
            "Used by 'map [radius]' command."
         ]
      },
      "mud.presence": {
         "kind": "utility",
         "path": "worldcore/mud/PresenceCommands.ts",
         "functions": [
            "who(sessions:SessionManager):Promise<string>",
            "nearby(sessions:SessionManager, regionId:string|null):Promise<string>"
         ],
         "dependsOn": [
            "core.sessions",
            "guilds.service"
         ],
         "notes": [
            "Implements 'who' and 'nearby' using SessionManager + GuildService."
         ]
      },
      "mud.progression": {
         "kind": "facade",
         "path": "worldcore/mud/MudProgression.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "progression.core",
            "progression.tasks",
            "progression.titles",
            "progression.quests"
         ],
         "provides": [
            "ensureProgression(char)",
            "incrementProgressionCounter(char, category, key, amount?)",
            "recordActionProgress(char, key, amount?)",
            "ensureTaskList(char)",
            "updateTasksFromProgress(char)",
            "ensureTitlesContainer(char)",
            "updateTitlesFromProgress(char)",
            "ensureQuestState(char)",
            "updateQuestsFromProgress(char)",
            "renderQuestLog(char)"
         ],
         "notes": [
            "Thin adapter between core progression modules and MUD-facing code.",
            "Keeps MUD imports stable even if progression internals move."
         ]
      },
      "mud.progressionHooks": {
         "kind": "service",
         "path": "worldcore/mud/MudProgressionHooks.ts",
         "class": "MudProgressionHooks",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.progression",
            "characters.service",
            "characters.titles",
            "progression.rewards"
         ],
         "provides": [
            "applyProgressionForEvent(ctx:MudContext, char:CharacterState, category:'kills'|'harvests', key:string):Promise<{snippets:string[]}>"
         ],
         "notes": [
            "Handles kill/harvest progression reactions: tasks, titles, quests, rewards, and DB patch.",
            "Does NOT increment counters itself; action handlers fire applyProgressionEvent in ProgressionCore directly."
         ]
      },
      "mud.resources": {
         "kind": "legacy_facade",
         "path": "worldcore/mud/MudResources.ts",
         "lifecycle": "stateless",
         "dependsOn": [],
         "provides": [
            "ensurePowerResourceMap(char)",
            "getOrInitPowerResource(char, kind)",
            "trySpendPowerResource(char, kind, cost)",
            "gainPowerResource(char, kind, amount)",
            "getPrimaryPowerResourceForClass(classId)"
         ],
         "notes": [
            "Older MUD-local resource helpers; new code prefers '../resources/PowerResources'.",
            "Safe to treat as compatibility layer while refactoring."
         ]
      },
      "mud.runtime": {
         "kind": "utility",
         "path": "worldcore/mud/runtime/mudRuntime.ts",
         "functions": [
            "getSelfEntity"
         ],
         "dependsOn": [
            "mud.context",
            "core.entities"
         ],
         "notes": [
            "Helper to resolve the world entity owned by the current session.",
            "Used by talk and other world-interaction commands that need the player entity."
         ]
      },
      "mud.spells": {
         "kind": "service",
         "path": "worldcore/mud/MudSpells.ts",
         "lifecycle": "stateless",
         "dependsOn": [
            "mud.context",
            "spells.table",
            "resources.power",
            "combat.cooldowns",
            "mud.actions.combat",
            "mud.helpers",
            "skills.progression"
         ],
         "provides": [
            "listKnownSpellsForChar(char):SpellDefinition[]",
            "castSpellForCharacter(ctx, char, spell, targetNameRaw?):Promise<string>",
            "handleCastCommand(ctx, char, spellNameRaw, targetNameRaw?):Promise<string>"
         ],
         "notes": [
            "Implements 'spells' and 'cast <name> [target]'.",
            "Supports damage_single_npc and heal_self kinds; others log as unhandled for now."
         ]
      },
      "mud.trainingDummy": {
         "kind": "service",
         "path": "worldcore/mud/MudTrainingDummy.ts",
         "lifecycle": "singleton",
         "dependsOn": [
            "mud.context",
            "core.sessions"
         ],
         "provides": [
            "getTrainingDummyForRoom(roomId):TrainingDummyState",
            "computeTrainingDummyDamage(attrs):number",
            "startTrainingDummyAi(ctx, sessionId, roomId):void",
            "stopTrainingDummyAi(sessionId):void"
         ],
         "notes": [
            "Provides per-room immortal training dummies and their simple AI loop.",
            "Used by attack/dummy flows and autoattack toggling."
         ]
      },
      "npc.crime": {
         "kind": "service",
         "path": "worldcore/npc/NpcCrime.ts",
         "functions": [
            "isProtectedNpc",
            "recordNpcCrimeAgainst",
            "resolveGuardCallRadius"
         ],
         "dependsOn": [
            "npc.types",
            "utils.logger"
         ],
         "notes": [
            "Determines which NPCs are 'protected' (civilian, vendor, questgiver, protected_town, etc.) and records crimes against them on the attacker.",
            "Sets recentCrimeUntil and recentCrimeSeverity (minor|severe) on characters to drive guard response."
         ]
      },
      "npc.manager": {
         "kind": "service",
         "path": "worldcore/npc/NpcManager.ts",
         "class": "NpcManager",
         "dependsOn": [
            "core.entities",
            "core.sessions",
            "npc.types",
            "npc.threat",
            "npc.crime",
            "ai.localSimpleBrain",
            "combat.entityCombat",
            "classes.definitions",
            "utils.logger"
         ],
         "notes": [
            "Owns runtime NPC state, per-room maps, threat tables, and bridges EntityManager \u2194 AI brain \u2194 sessions/chat.",
            "Spawns/Despawns NPCs, applies damage, records threat, coordinates guard/pack help, coward fleeing, gating, and drives AI decisions each tick."
         ]
      },
      "npc.postgres": {
         "kind": "service",
         "path": "worldcore/npc/PostgresNpcService.ts",
         "class": "PostgresNpcService",
         "dependsOn": [
            "db.main",
            "npc.types"
         ],
         "notes": [
            "Loads NPC prototypes and loot tables from npcs and npc_loot tables.",
            "Maps DB rows into NpcPrototype and NpcLootEntry arrays suitable for setNpcPrototypes."
         ]
      },
      "npc.spawnController": {
         "kind": "service",
         "path": "worldcore/npc/NpcSpawnController.ts",
         "class": "NpcSpawnController",
         "dependsOn": [
            "npc.manager",
            "world.spawnPoints",
            "core.entities",
            "progression.core",
            "utils.logger"
         ],
         "notes": [
            "Controls NPC and resource/node spawning from DB-backed SpawnPointService.",
            "Spawns shared NPCs per room and personal resource nodes per player, respecting per-character depletion via isNodeAvailable and deduping spawn points per scope."
         ]
      },
      "npc.threat": {
         "kind": "service",
         "path": "worldcore/npc/NpcThreat.ts",
         "functions": [
            "updateThreatFromDamage",
            "getLastAttackerFromThreat"
         ],
         "notes": [
            "Minimal threat bookkeeping: last attacker entity id and timestamp.",
            "Used by NpcManager to steer AI targeting toward whoever last harmed the NPC."
         ]
      },
      "npc.types": {
         "kind": "model",
         "path": "worldcore/npc/NpcTypes.ts",
         "notes": [
            "Defines NpcId, GuardProfile, NpcBehavior, NpcLootEntry, NpcPrototype, and NpcRuntimeState.",
            "Includes DEFAULT_NPC_PROTOTYPES (training_dummy, town_rat, coward_rat, ore_vein_small, town_guard, rat_pack_raider, bandit_caster) plus guard call radius helpers and a live prototype registry."
         ]
      },
      "progression.core": {
         "kind": "service",
         "path": "worldcore/progression/ProgressionCore.ts",
         "functions": [
            "ensureProgression",
            "incrementProgressionCounter",
            "recordActionProgress",
            "applyProgressionEvent",
            "getNodeDepletedUntil",
            "isNodeAvailable",
            "setNodeDepletedUntil"
         ],
         "dependsOn": [
            "characters.types",
            "progression.events.raw"
         ],
         "notes": [
            "Canonical per-character progression blob and event application logic.",
            "Tracks kills, harvests, actions, collects, flags, exploration, gathering, quests, tasks, and titles.",
            "Also encodes personal node depletion using progression flags."
         ]
      },
      "progression.eventSink": {
         "kind": "service_contract",
         "path": "worldcore/progression/ProgressionEventSink.ts",
         "functions": [
            "recordEvent"
         ],
         "dependsOn": [
            "progression.core"
         ],
         "notes": [
            "Async sink interface for streaming ProgressionEvent records to external stores.",
            "Extends events with userId, characterId, shardId, roomId, and occurredAt."
         ]
      },
      "progression.events.highLevel": {
         "kind": "model",
         "path": "worldcore/progression/ProgressionEvents.ts",
         "notes": [
            "Older high-level ProgressEvent model with kinds kill_npc, harvest_node, item_turnin, talk_to_npc, visit_room.",
            "Kept for compatibility with any legacy progression/quest triggers that still use this shape."
         ]
      },
      "progression.events.raw": {
         "kind": "model",
         "path": "worldcore/progression/ProgressEvents.ts",
         "notes": [
            "Low-level immutable ProgressEvent log shape used for analytics or external sinks.",
            "Defines ProgressEventKind, GatheringKind, GatheringStats, and ProgressEvent payload."
         ]
      },
      "progression.helpers": {
         "kind": "service",
         "path": "worldcore/progression/ProgressionHelpers.ts",
         "functions": [
            "normalizeProgression",
            "getOrInitPowerResource",
            "modifyPowerResource",
            "getCooldowns",
            "isAbilityOnCooldown",
            "setAbilityCooldown",
            "getSkills",
            "getOrInitSkillBucket",
            "getGathering",
            "getOrInitGatherDiscipline"
         ],
         "dependsOn": [
            "progression.types"
         ],
         "notes": [
            "Utility helpers to normalize and manipulate CharacterProgression.",
            "Covers power pools, cooldowns, generic skill buckets, and gathering disciplines."
         ]
      },
      "progression.progressText": {
         "kind": "service",
         "path": "worldcore/progression/progressText.ts",
         "functions": [
            "renderProgressText"
         ],
         "dependsOn": [
            "progression.tasks.types"
         ],
         "notes": [
            "Renders a 'Progress:' text block showing kills, harvests, and simple tasks with [ ]/[x] markers.",
            "Used by the 'progress' MUD command."
         ]
      },
      "progression.rewards.tasks": {
         "kind": "service",
         "path": "worldcore/progression/rewards/grantTaskRewards.ts",
         "functions": [
            "grantTaskRewards"
         ],
         "dependsOn": [
            "utils.logger",
            "characters.service?",
            "economy.helpers"
         ],
         "notes": [
            "Aggregates XP, gold, and item rewards from completed tasks and applies them to the character.",
            "Uses characters.grantXp and EconomyHelpers.grantReward, with optional patchCharacter to persist inventory."
         ]
      },
      "progression.tasks.engine": {
         "kind": "service",
         "path": "worldcore/progression/tasks/taskEngine.ts",
         "functions": [
            "ensureTaskList",
            "updateTasksFromProgress"
         ],
         "dependsOn": [
            "progression.core",
            "progression.tasks.types",
            "characters.types"
         ],
         "notes": [
            "Maintains prog.tasks as SimpleTask[] and updates completion based on kills/harvests counters.",
            "Returns a list of newly completed tasks for reward processing."
         ]
      },
      "progression.tasks.types": {
         "kind": "model",
         "path": "worldcore/progression/tasks/taskTypes.ts",
         "notes": [
            "Defines SimpleTask with id, type ('kill'|'harvest'), target, required count, completion flag, and optional reward.",
            "Used by taskEngine, progress text, and reward logic."
         ]
      },
      "progression.titles.setActive": {
         "kind": "service",
         "path": "worldcore/progression/titles/setActiveTitle.ts",
         "functions": [
            "setActiveTitle"
         ],
         "dependsOn": [
            "utils.logger",
            "mud.progression",
            "characters.titles"
         ],
         "notes": [
            "Parses user input from 'settitle', fuzzy-matches to an unlocked title id, and sets it active.",
            "Persists updated progression via ctx.characters.patchCharacter when available."
         ]
      },
      "progression.titles.state": {
         "kind": "service",
         "path": "worldcore/progression/titles/titleState.ts",
         "functions": [
            "ensureTitlesContainer",
            "updateTitlesFromProgress"
         ],
         "dependsOn": [
            "characters.types",
            "progression.core",
            "characters.titles"
         ],
         "notes": [
            "Ensures prog.titles exists and is well-formed, with unlocked[] and active.",
            "Computes newly unlocked titles from kills/harvests using TITLES unlock rules."
         ]
      },
      "progression.titles.text": {
         "kind": "service",
         "path": "worldcore/progression/titles/titleText.ts",
         "functions": [
            "renderCurrentTitle",
            "renderTitlesList"
         ],
         "dependsOn": [
            "progression.titles.state",
            "characters.titles"
         ],
         "notes": [
            "Renders 'Current title: ...' and 'Titles:' lists using TITLES definitions.",
            "Used by 'title' and 'titles' MUD commands."
         ]
      },
      "progression.types": {
         "kind": "model",
         "path": "worldcore/progression/ProgressionTypes.ts",
         "notes": [
            "Defines PowerResourceState, CooldownsState, SkillsState, TitlesState, GatheringState, CountersState, and FlagsState.",
            "Represents the canonical character.progression JSON layout."
         ]
      },
      "protocol.objects": {
         "kind": "model",
         "path": "worldcore/protocol/ObjectMessages.ts",
         "dependsOn": [
            "shards.worldBlueprint"
         ],
         "notes": [
            "Defines ClientObjectRequestPayload and ObjectChunkPayload for static world objects and spawn points.",
            "Used by ObjectStream and any client that wants shared types for blueprint objects and spawns."
         ]
      },
      "protocol.terrain": {
         "kind": "model",
         "path": "worldcore/protocol/WGEv3ChunkProtocol.ts",
         "notes": [
            "Single source of truth for WGEv3 terrain streaming protocol.",
            "Defines TerrainChunkCoord, TerrainChunkId, TerrainBlueprintMeta, TerrainChunkDataWire, and client/server terrain message envelopes and unions.",
            "Provides type guards isClientTerrainMessage and isServerTerrainMessage."
         ]
      },
      "quests.engine": {
         "kind": "service",
         "path": "worldcore/quests/QuestEngine.ts",
         "functions": [
            "updateQuestsFromProgress"
         ],
         "dependsOn": [
            "progression.core",
            "quests.state",
            "quests.registry",
            "items.inventoryHelpers",
            "characters.types"
         ],
         "notes": [
            "Scans all quests against kills, harvests, actions, flags, and inventory to update completion state.",
            "Marks active quests as completed when all objectives are satisfied and returns the completed list."
         ]
      },
      "quests.postgres": {
         "kind": "service",
         "path": "worldcore/quests/PostgresQuestService.ts",
         "class": "PostgresQuestService",
         "dependsOn": [
            "db.main",
            "utils.logger",
            "quests.service",
            "quests.types"
         ],
         "notes": [
            "Loads quest definitions, objectives, and rewards from Postgres quests, quest_objectives, and quest_rewards tables.",
            "Aggregates reward rows into QuestReward (xp, gold, items, titles) and maps objective rows into QuestObjective.",
            "Implements listQuests and getQuest with filtering on is_enabled and repeatable/maxCompletions mapping."
         ]
      },
      "quests.registry": {
         "kind": "service",
         "path": "worldcore/quests/QuestRegistry.ts",
         "functions": [
            "setQuestDefinitions",
            "getQuestById",
            "getAllQuests"
         ],
         "dependsOn": [
            "quests.types"
         ],
         "notes": [
            "Wraps QUESTS in a mutable registry so quests can be loaded from DB.",
            "setQuestDefinitions replaces questMap with provided definitions."
         ]
      },
      "quests.service": {
         "kind": "service_contract",
         "path": "worldcore/quests/QuestService.ts",
         "notes": [
            "QuestService interface: getQuest, listQuests, and optional admin-style createOrUpdateQuest/deleteQuest.",
            "Implemented by PostgresQuestService."
         ]
      },
      "quests.state": {
         "kind": "service",
         "path": "worldcore/quests/QuestState.ts",
         "functions": [
            "ensureQuestState"
         ],
         "dependsOn": [
            "progression.core",
            "characters.types"
         ],
         "notes": [
            "Defines QuestStateEntry (state and completions) and QuestStateMap.",
            "ensureQuestState attaches quest state to char.progression.quests."
         ]
      },
      "quests.text": {
         "kind": "service",
         "path": "worldcore/quests/QuestText.ts",
         "functions": [
            "renderQuestLog"
         ],
         "dependsOn": [
            "progression.core",
            "quests.state",
            "quests.registry",
            "items.inventoryHelpers",
            "characters.types"
         ],
         "notes": [
            "Renders textual quest log including status marks [ ], [C], [T] and repeatable completion counters.",
            "Prints per-objective progress lines for kill, harvest, collect_item, craft, city, and talk_to objectives."
         ]
      },
      "quests.turnIn": {
         "kind": "service",
         "path": "worldcore/quests/turnInQuest.ts",
         "functions": [
            "turnInQuest"
         ],
         "dependsOn": [
            "mud.context",
            "characters.types",
            "quests.registry",
            "quests.state",
            "progression.core",
            "items.inventoryHelpers",
            "economy.helpers"
         ],
         "notes": [
            "Handles quest turn-in: resolves quest by id/name, checks completion and repeatable caps, and revalidates objectives.",
            "Consumes collect_item requirements from inventory, applies XP via ctx.characters.grantXp, and grants gold/items via grantReward.",
            "Unlocks title rewards, updates quest completions and state (active/turned_in), and patches character progression + inventory."
         ]
      },
      "quests.types": {
         "kind": "model",
         "path": "worldcore/quests/QuestTypes.ts",
         "functions": [
            "listAllQuests"
         ],
         "notes": [
            "Defines QuestObjectiveKind (kill, harvest, collect_item, craft, city, talk_to) and their concrete interfaces.",
            "Defines QuestReward and QuestDefinition with repeatable/maxCompletions fields.",
            "Provides QUESTS hardcoded map including rat_culling, ore_sampling, rat_tail_collection, greet_quartermaster."
         ]
      },
      "resources.power": {
         "kind": "service",
         "path": "worldcore/resources/PowerResources.ts",
         "functions": [
            "ensurePowerResourceMap",
            "getOrInitPowerResource",
            "trySpendPowerResource",
            "gainPowerResource",
            "getPrimaryPowerResourceForClass"
         ],
         "dependsOn": [
            "characters.types",
            "utils.logger"
         ],
         "notes": [
            "Manages Fury/Mana pools stored under char.progression.powerResources.",
            "Provides class->primary resource mapping and helpers to spend/gain power."
         ]
      },
      "shards.worldBlueprint": {
         "kind": "model",
         "path": "worldcore/shards/WorldBlueprint.ts",
         "functions": [
            "buildDemoPrimeWorld"
         ],
         "dependsOn": [
            "terrain.regionTypes"
         ],
         "notes": [
            "Defines WorldBoundary, BlueprintObject, SpawnPoint, and WorldBlueprint for shards.",
            "buildDemoPrimeWorld() creates the current demo Prime Shard blueprint used by ServerWorldManager."
         ]
      },
      "shared.entities": {
         "kind": "model",
         "path": "worldcore/shared/Entity.ts",
         "notes": [
            "Defines Entity: id, type, roomId, ownerSessionId, position, facing, HP, labels, spawn metadata, and targetId.",
            "Used by EntityManager, combat, NPC systems, and MUD commands."
         ]
      },
      "shared.messages": {
         "kind": "model",
         "path": "worldcore/shared/messages.ts",
         "notes": [
            "Defines ClientOpcode, ServerOpcode, ClientMessage, ServerMessage, WhereAmI* messages, and MudResultPayload.",
            "Shared envelope protocol for MMO/MUD/Web clients over WebSocket."
         ]
      },
      "shared.region": {
         "kind": "alias",
         "path": "worldcore/shared/region.ts",
         "dependsOn": [
            "terrain.regionTypes"
         ],
         "notes": [
            "Re-exports RegionId, Region, and RegionSample from terrain/regions/RegionTypes.",
            "Convenience alias to avoid deep import paths in callers."
         ]
      },
      "shared.session": {
         "kind": "model",
         "path": "worldcore/shared/Session.ts",
         "notes": [
            "Defines Session: id, displayName, WebSocket, roomId, lastSeen, shardId, identity, and attached CharacterState.",
            "Used by SessionManager and MUD/sessionLookup helpers."
         ]
      },
      "shared.wgev3ChunkProtocol": {
         "kind": "alias",
         "path": "worldcore/shared/WGEv3ChunkProtocol.ts",
         "notes": [
            "Re-exports the canonical WGEv3ChunkProtocol from worldcore/protocol.",
            "Kept for backward compatibility with older imports."
         ]
      },
      "shared.worldCoreContext": {
         "kind": "types",
         "path": "worldcore/shared/WorldCoreContext.ts",
         "notes": [
            "Defines lightweight SessionLike, SessionsManagerLike, and EntitiesManagerLike interfaces.",
            "Used where full SessionManager/EntityManager are not desired as hard deps."
         ]
      },
      "sim.brainActions": {
         "kind": "types",
         "path": "worldcore/sim/BrainActions.ts",
         "notes": [
            "Types for Mother-Brain style planning outputs (audit \u2192 plan actions \u2192 apply).",
            "Includes PlaceSpawnAction used by SettlementPlanner + simBrain apply."
         ]
      },
      "sim.gapFiller": {
         "kind": "utility",
         "path": "worldcore/sim/GapFiller.ts",
         "provides": [
            "planGapFillSpawns(existingSpawns, cfg) -> GapFillSpawn[]",
            "Worst-gap-first loop; places at cell center; enforces minDistance from graveyard/checkpoint blockers."
         ],
         "dependsOn": [
            "sim.grid",
            "sim.respawnCoverage"
         ],
         "notes": [
            "Gap filling planner for respawn coverage: adds checkpoints/graveyards only where gaps exist.",
            "Deterministic spawnId per cell (`checkpoint_gap_<cx>_<cz>` etc.) so reruns update rather than duplicate."
         ]
      },
      "sim.grid": {
         "kind": "utility",
         "path": "worldcore/sim/SimGrid.ts",
         "provides": [
            "cellCenter(cell, cellSize)",
            "cellBounds(cell, cellSize)",
            "makeRegionId(shardId, cell) -> `${shardId}:${cx},${cz}`",
            "parseBounds(spec) -> Bounds",
            "other grid helpers"
         ],
         "notes": [
            "Grid primitives for simulation and world tooling (cell bounds, region ids, cell center math).",
            "Shared by settlement planner, respawn coverage report, and gap filler."
         ]
      },
      "sim.respawnCoverage": {
         "kind": "utility",
         "path": "worldcore/sim/RespawnCoverage.ts",
         "provides": [
            "computeRespawnCoverage(spawns, cfg) -> { rows, summary }",
            "Eligibility: graveyard/checkpoint always; settlement-ish types unless variantId === 'kos'"
         ],
         "dependsOn": [
            "sim.grid"
         ],
         "notes": [
            "Respawn coverage auditing utilities for the Dev Simulation Harness.",
            "Scans a cell bounds box and marks each cell center covered if within respawnRadius of an eligible respawn source."
         ]
      },
      "sim.rng": {
         "kind": "utility",
         "path": "worldcore/sim/SimRng.ts",
         "class": "SimRng",
         "lifecycle": "factory",
         "ctorArgs": [
            "seed"
         ],
         "dependsOn": [],
         "provides": [
            "shuffle(array) -> newArray",
            "hash32(string) -> uint32",
            "other deterministic RNG helpers"
         ],
         "notes": [
            "Deterministic RNG utilities for repeatable world planning."
         ]
      },
      "sim.settlementPlanner": {
         "kind": "utility",
         "path": "worldcore/sim/SettlementPlanner.ts",
         "provides": [
            "planInitialOutposts(factions, cfg) -> BrainAction[]"
         ],
         "dependsOn": [
            "sim.grid",
            "sim.rng",
            "sim.brainActions"
         ],
         "notes": [
            "Deterministic outpost placement with spacing constraints inside cell bounds.",
            "SpawnId format: outpost_<factionKey>_<index>_<cx>_<cz>.",
            "Supports FactionSeedSpec.startIndex to avoid spawnId collisions in append-only (safe) runs.",
            "Adds deterministic jitter within a cell border margin."
         ]
      },
      "skills.progression": {
         "kind": "service",
         "path": "worldcore/skills/SkillProgression.ts",
         "functions": [
            "getWeaponSkill",
            "gainWeaponSkill",
            "getSpellSchoolSkill",
            "gainSpellSchoolSkill",
            "getSongSchoolSkill",
            "gainSongSchoolSkill"
         ],
         "dependsOn": [
            "characters.types",
            "combat.engine"
         ],
         "notes": [
            "Stores weapon, spell, and song instrument skills under char.progression.skills.",
            "Skills are capped at level * 10 and default to 0 if missing."
         ]
      },
      "songs.engine": {
         "kind": "service",
         "path": "worldcore/songs/SongEngine.ts",
         "functions": [
            "getSongsState",
            "getMelody",
            "setMelody",
            "addSongToMelody",
            "removeSongFromMelody",
            "clearMelody",
            "setMelodyActive",
            "tickSongsForCharacter"
         ],
         "dependsOn": [
            "characters.types",
            "mud.context",
            "spells.types",
            "mud.spells",
            "utils.logger",
            "core.entities"
         ],
         "notes": [
            "Manages Virtuoso song state and melodies stored under char.progression.songs.",
            "tickSongsForCharacter auto-casts a rotating list of Virtuoso songs on a timer using the normal spell pipeline."
         ]
      },
      "spells.types": {
         "kind": "model",
         "path": "worldcore/spells/SpellTypes.ts",
         "functions": [
            "findSpellByNameOrId"
         ],
         "dependsOn": [
            "combat.engine",
            "resources.power",
            "skills.progression"
         ],
         "notes": [
            "Defines SpellDefinition and SpellKind plus the SPELLS registry.",
            "Includes debug_arcane_bolt, mage_fire_bolt, cleric_minor_heal, and Virtuoso song spells."
         ]
      },
      "strategy.regionService": {
         "kind": "service",
         "path": "worldcore/strategy/api/RegionService.ts",
         "class": "RegionService",
         "dependsOn": [
            "shards.worldBlueprint",
            "terrain.regionTypes"
         ],
         "notes": [
            "Query helper over WorldBlueprint for city-builder/strategy layer.",
            "Can list all shards, all regions, regions per shard, and filter by biome or tag."
         ]
      },
      "strategy.world": {
         "kind": "service",
         "path": "worldcore/strategy/domain/world.ts",
         "functions": [
            "seedWorld"
         ],
         "dependsOn": [
            "shards.worldBlueprint"
         ],
         "notes": [
            "Defines domain-level World and WorldShard types for the strategy layer.",
            "seedWorld() builds the demo Prime Shard world from buildDemoPrimeWorld with biome-based danger ratings."
         ]
      },
      "systems.recovery": {
         "kind": "service",
         "path": "worldcore/systems/recovery/recoveryOps.ts",
         "functions": [
            "restoreEntityToFull",
            "respawnInPlace",
            "restOrSleep"
         ],
         "dependsOn": [
            "combat.entityCombat"
         ],
         "notes": [
            "Recovery helpers operating on entities via a RecoveryContext with session and entities provider.",
            "respawnInPlace and restOrSleep resurrect or fully restore the player entity and shut down autoattack/training dummy hooks."
         ]
      },
      "systems.regen": {
         "kind": "service",
         "path": "worldcore/systems/regen/ensureRegenLoop.ts",
         "functions": [
            "ensureRegenLoop"
         ],
         "dependsOn": [
            "core.sessions",
            "core.entities",
            "combat.entityCombat"
         ],
         "notes": [
            "Starts a global HP regen loop once, ticking every 5 seconds.",
            "Iterates all sessions and heals non-dead, out-of-combat entities by a fixed amount up to maxHp."
         ]
      },
      "targeting.finders": {
         "kind": "utility",
         "path": "worldcore/targeting/targetFinders.ts",
         "functions": [
            "findTargetPlayerEntityByName",
            "findNearestNpcByName",
            "findNpcTargetByName"
         ],
         "dependsOn": [
            "core.sessions",
            "core.entities",
            "shared.entities"
         ],
         "notes": [
            "High-level helpers for resolving player and NPC targets by name within a room.",
            "Supports numbered syntax like 'guard.2' and pure index-based targeting for NPCs."
         ]
      },
      "targeting.resolver": {
         "kind": "utility",
         "path": "worldcore/targeting/TargetResolver.ts",
         "functions": [
            "resolveTargetInRoom"
         ],
         "dependsOn": [
            "shared.entities"
         ],
         "notes": [
            "Resolves a target entity in a room by index ('2'), short handle ('rat.1'), or partial name.",
            "Normalizes names and filters by a caller-provided predicate."
         ]
      },
      "terrain.biomeRules": {
         "kind": "utility",
         "path": "worldcore/terrain/biomes/BiomeRules.ts",
         "function": "computeBiome",
         "dependsOn": [
            "backend.worldDimensions?"
         ],
         "provides": [
            "computeBiome(x:number, z:number, height:number, slope:number, dim:WorldDimensions):BiomeResult"
         ],
         "notes": [
            "Scale-aware simple biome classifier used by older pipelines.",
            "Currently imports WorldDimensions from planarwar-backend; treat as optional bridge."
         ]
      },
      "terrain.heightmap": {
         "kind": "utility",
         "path": "worldcore/terrain/height/Heightmap.ts",
         "class": "Heightmap",
         "lifecycle": "factory",
         "ctorArgs": [
            "seed:number"
         ],
         "dependsOn": [],
         "provides": [
            "setNoiseScale(scale:number)",
            "sample(x:number, z:number, biome?:string):number",
            "sampleSlope(x:number, z:number, biomeHint?:string):number"
         ],
         "notes": [
            "Deterministic 2D noise heightfield used by ServerWorldManager and RegionMap.",
            "Biome hint tweaks terrain shape slightly for roads/rivers/hills/farms/etc."
         ]
      },
      "terrain.index": {
         "kind": "barrel",
         "path": "worldcore/terrain/index.ts",
         "reexports": [
            "terrain.heightmap",
            "terrain.regionTypes",
            "terrain.regionSampler",
            "terrain.regionMap",
            "worldgen.scaled"
         ]
      },
      "terrain.regionDifficulty": {
         "kind": "utility",
         "path": "worldcore/terrain/regions/RegionDifficulty.ts",
         "function": "getRegionTier",
         "dependsOn": [
            "terrain.regionTypes"
         ],
         "provides": [
            "getRegionTier(region:Region):1|2|3|4|5"
         ],
         "notes": [
            "Computes difficulty tier by radial distance from world center.",
            "Uses max world radius \u2248 2048 units for current prime shard."
         ]
      },
      "terrain.regionDisplay": {
         "kind": "utility",
         "path": "worldcore/terrain/regions/RegionDisplay.ts",
         "function": "getRegionDisplayName",
         "dependsOn": [
            "terrain.regionTypes",
            "terrain.regionNaming",
            "factions.types?"
         ],
         "provides": [
            "getRegionDisplayName(region:Region, controllingFaction?):string"
         ],
         "notes": [
            "UI helper that decorates region name with 'Domain of <faction>'."
         ]
      },
      "terrain.regionMap": {
         "kind": "service",
         "path": "worldcore/terrain/regions/RegionMap.ts",
         "class": "RegionMap",
         "lifecycle": "factory",
         "ctorArgs": [
            "terrain.heightmap",
            "{ worldId, seed, worldRadius, cellSize? }"
         ],
         "dependsOn": [
            "terrain.heightmap"
         ],
         "provides": [
            "getRegionAt(x:number, z:number):Region|undefined",
            "getBiomeAt(x:number, z:number):string",
            "sampleAt(x:number, z:number):RegionSample|undefined",
            "toOverviewGrid(overviewSize?:number):Region[]"
         ],
         "notes": [
            "Lazy LRU-cached region grid over a circular world disk.",
            "Used by ServerWorldManager for region lookup and overview generation."
         ]
      },
      "terrain.regionNaming": {
         "kind": "utility",
         "path": "worldcore/terrain/regions/RegionNaming.ts",
         "function": "generateRegionName",
         "dependsOn": [
            "terrain.regionTypes"
         ],
         "provides": [
            "generateRegionName(region:Region):string"
         ],
         "notes": [
            "Deterministic procedural names based on biome and position.",
            "Uses internal RNG seeded by worldId + region.id so names are stable."
         ]
      },
      "terrain.regionSampler": {
         "kind": "utility",
         "path": "worldcore/terrain/regions/RegionSampler.ts",
         "class": "RegionSampler",
         "lifecycle": "factory",
         "ctorArgs": [
            "worldId:string",
            "seed:number",
            "terrain.heightmap"
         ],
         "dependsOn": [
            "terrain.heightmap"
         ],
         "provides": [
            "sampleRegion(cx:number, cz:number, radius:number):Region"
         ],
         "notes": [
            "Older helper: random (non-deterministic) sampling of avg height/slope in a disk.",
            "Safe to treat as legacy; RegionMap is the main runtime authority."
         ]
      },
      "terrain.regionTypes": {
         "kind": "model",
         "path": "worldcore/terrain/regions/RegionTypes.ts",
         "types": [
            "RegionId",
            "Region",
            "RegionSample"
         ],
         "notes": [
            "Shared region data model for MMO, strategy layer, and tools."
         ]
      },
      "tools.simBrain": {
         "kind": "dev_script",
         "path": "worldcore/tools/simBrain.ts",
         "dependsOn": [
            "db.main",
            "sim.settlementPlanner",
            "sim.respawnCoverage",
            "sim.gapFiller",
            "world.spawnPoints"
         ],
         "provides": [
            "preview/apply: deterministic settlement/outpost planning (dry-run vs --commit)",
            "apply safe mode: append-only outposts via --append (auto-enabled when using caps/total-mode)",
            "apply caps: --factionsAreTotal and --maxOutpostsPerFaction constrain total outposts per faction (existing+new)",
            "report: respawn coverage audit across bounds",
            "fill-gaps: place checkpoints/graveyards to patch coverage gaps (dry-run vs --commit)",
            "era: orchestrated run (outposts + gap-fill + coverage before/after) and writes a JSON artifact (default: ./artifacts/brain)",
            "wipe-placements: deletes placement spawn types (default outpost/checkpoint/graveyard) inside bounds (dry-run unless --commit), writes an artifact",
            "status: quick counts (types + outposts by faction) + coverage summary for bounds",
            "safety: refuses --commit without explicit --bounds (unless --allowDefaultBounds); refuses literal ... args",
            "default insert-only apply (no updates) unless --updateExisting",
            "trim-outposts: enforces max outposts per faction by deleting extra outposts within bounds (dry-run unless --commit), writes an artifact"
         ],
         "notes": [
            "Dev Simulation Harness CLI entrypoint (worldcore/tools/simBrain.ts).",
            "Follows audit  plan  apply pattern with safe default rollback unless --commit.",
            "era produces a durable artifact describing the planned/applied changes for handoffs and reproducibility."
         ]
      },
      "trade.auditLog": {
         "kind": "service",
         "path": "worldcore/trade/TradeAuditLog.ts",
         "functions": [
            "logCompletedTrade"
         ],
         "dependsOn": [
            "db.main",
            "utils.logger",
            "trade.types"
         ],
         "notes": [
            "Persists completed trades into trade_log table including gold before/after and JSON-encoded item lists.",
            "Errors are caught and logged without breaking the trade flow."
         ]
      },
      "trade.memory": {
         "kind": "service",
         "path": "worldcore/trade/InMemoryTradeService.ts",
         "class": "InMemoryTradeService",
         "dependsOn": [
            "auth.types",
            "trade.types",
            "trade.service"
         ],
         "notes": [
            "In-memory implementation of TradeService using Maps keyed by session id and character id.",
            "Supports one active trade per character and manages status transitions including both_confirmed."
         ]
      },
      "trade.ops": {
         "kind": "utility",
         "path": "worldcore/trade/tradeOps.ts",
         "functions": [
            "formatTradeSessionView",
            "finalizeTrade"
         ],
         "dependsOn": [
            "trade.types",
            "trade.auditLog",
            "characters.types",
            "items.inventoryHelpers",
            "economy.helpers"
         ],
         "notes": [
            "Pure trade finalization logic operating on inventories and gold amounts.",
            "Validates that offered items and gold still exist, moves items between inventories, updates gold, logs the trade, notifies both sessions, and marks the session as completed."
         ]
      },
      "trade.service": {
         "kind": "service_contract",
         "path": "worldcore/trade/TradeService.ts",
         "notes": [
            "TradeService interface: createSession, getSessionFor, cancelFor, clearOffers, setOfferGold, addOfferItem, setAccepted.",
            "Implemented by InMemoryTradeService and used by trade commands."
         ]
      },
      "trade.types": {
         "kind": "model",
         "path": "worldcore/trade/TradeTypes.ts",
         "notes": [
            "Defines TradeStatus, TradeItemOffer, TradeSide, and TradeSession.",
            "Shared between trade service, audit log, and tradeOps."
         ]
      },
      "tradeskills.recipes": {
         "kind": "service",
         "path": "worldcore/tradeskills/RecipeCatalog.ts",
         "functions": [
            "listAllRecipes",
            "getRecipe",
            "findRecipeByIdOrName"
         ],
         "dependsOn": [
            "tradeskills.types"
         ],
         "notes": [
            "Static v1 recipe catalog for smelting and alchemy test recipes (e.g., smelt_iron_ingot, brew_minor_heal).",
            "Provides lookup helpers by id and by case-insensitive name."
         ]
      },
      "tradeskills.types": {
         "kind": "model",
         "path": "worldcore/tradeskills/RecipeTypes.ts",
         "notes": [
            "Defines TradeskillCategory, RecipeIngredient, RecipeOutput, TradeRecipe, and RecipeMap.",
            "Used by RecipeCatalog and crafting commands."
         ]
      },
      "types.shims": {
         "kind": "types",
         "path": "worldcore/types/shims.d.ts",
         "notes": [
            "Ambient declarations for Node/third-party modules (uuid, ws, pg, redis, dotenv, jsonwebtoken, crypto, node:test, assert).",
            "Also declares process, console, timers, and NodeJS.Timeout so TS can compile in bare JS runtimes."
         ]
      },
      "utils.colors": {
         "kind": "utility",
         "path": "worldcore/utils/colors.ts",
         "exports": [
            "Colors",
            "colorize"
         ],
         "dependsOn": [],
         "notes": [
            "ANSI color codes and colorize(text,color) helper for Node console output.",
            "Used by the logger and can be reused by any CLI tools."
         ]
      },
      "utils.logger": {
         "kind": "utility",
         "path": "worldcore/utils/logger.ts",
         "class": "Logger",
         "dependsOn": [
            "utils.colors",
            "config.logconfig"
         ],
         "notes": [
            "Scope-based logger with timestamp, level coloring, and logEnabled(scope,level) filtering.",
            "Provides debug/info/warn/error/success methods and a static scope(scope) factory."
         ]
      },
      "utils.random": {
         "kind": "utility",
         "path": "worldcore/utils/random.ts",
         "functions": [
            "rollInt"
         ],
         "dependsOn": [
            "utils.logger"
         ],
         "notes": [
            "Simple random integer helper: rollInt(min,max) using Math.random().",
            "Keeps a scoped logger for future debugging, though current implementation does not log."
         ]
      },
      "utils.rng": {
         "kind": "utility",
         "path": "worldcore/utils/Rng.ts",
         "class": "Rng",
         "dependsOn": [],
         "notes": [
            "Deterministic RNG based on a hashed seed (mulberry32-style).",
            "Provides next(), range(min,max), int(min,maxInclusive), and pick(list)."
         ]
      },
      "utils.uuid": {
         "kind": "utility",
         "path": "worldcore/utils/uuid.ts",
         "functions": [
            "uuidv4"
         ],
         "dependsOn": [],
         "notes": [
            "Wrapper around crypto.randomUUID() with a fallback fixed v4-like UUID if unavailable.",
            "Used anywhere a stable UUIDv4 string is needed without pulling extra deps."
         ]
      },
      "vendors.postgres": {
         "kind": "service",
         "path": "worldcore/vendors/PostgresVendorService.ts",
         "class": "PostgresVendorService",
         "dependsOn": [
            "db.main",
            "utils.logger",
            "vendors.types",
            "vendors.service"
         ],
         "notes": [
            "Postgres-backed implementation of VendorService.",
            "Queries vendors and vendor_items tables and maps rows to VendorDefinition and VendorItem."
         ]
      },
      "vendors.service": {
         "kind": "service_contract",
         "path": "worldcore/vendors/VendorService.ts",
         "notes": [
            "VendorService interface: getVendor(id) and listVendors().",
            "Implemented by PostgresVendorService and used by vendor commands."
         ]
      },
      "vendors.transactions": {
         "kind": "utility",
         "path": "worldcore/vendors/VendorTransactions.ts",
         "functions": [
            "resolveVendorItem",
            "buyFromVendor",
            "sellToVendor"
         ],
         "dependsOn": [
            "characters.types",
            "economy.helpers",
            "vendors.types"
         ],
         "notes": [
            "Pure transaction logic for buying and selling with vendors.",
            "buyFromVendor checks gold, tries to add items, then spends gold only for successfully added quantity.",
            "sellToVendor finds vendor price reference and pays 50% per unit, consuming items atomically."
         ]
      },
      "vendors.types": {
         "kind": "model",
         "path": "worldcore/vendors/VendorTypes.ts",
         "notes": [
            "Defines VendorItem (id,itemId,priceGold) and VendorDefinition (id,name,items).",
            "Shared shape for vendor services, economy helpers, and MUD commands."
         ]
      },
      "world.boundary": {
         "kind": "utility",
         "path": "worldcore/world/Boundary.ts",
         "class": "DomeBoundary",
         "lifecycle": "factory",
         "ctorArgs": [
            "centerX",
            "centerZ",
            "radius",
            "softRadius"
         ],
         "dependsOn": [],
         "provides": [
            "isInside(x, z)",
            "clampPosition(x, z) -> { x, z, clamped, distance }",
            "falloff(x, z) -> 0..1",
            "toState()",
            "fromState(DomeBoundaryState)"
         ],
         "notes": [
            "Pure math helper for circular play-area checks and soft edges.",
            "Currently not wired into ServerWorldManager; kept as reusable utility."
         ]
      },
      "world.events": {
         "kind": "service",
         "path": "worldcore/world/WorldEventBus.ts",
         "class": "WorldEventBus",
         "lifecycle": "singleton",
         "ctorArgs": [],
         "dependsOn": [],
         "provides": [
            "on(event, handler)",
            "off(event, handler)",
            "emit(event, payload)",
            "emitAsync(event, payload)",
            "clear()"
         ],
         "eventDomain": "world",
         "events": [
            "entity.spawned",
            "entity.despawned",
            "entity.moved",
            "region.changed",
            "room.entered",
            "room.exited",
            "npc.aggressed",
            "npc.died",
            "player.connected",
            "player.disconnected",
            "law.crime",
            "weather.changed"
         ],
         "notes": [
            "Typed pub/sub bus for world-layer events.",
            "Goal: future systems (AI, law, weather, crime) hang off this instead of directly calling each other."
         ]
      },
      "world.manager": {
         "kind": "service",
         "path": "worldcore/world/ServerWorldManager.ts",
         "class": "ServerWorldManager",
         "lifecycle": "singleton",
         "ctorArgs": [
            "seed?"
         ],
         "dependsOn": [],
         "provides": [
            "getWorldBlueprintForRoom(roomId)",
            "getWorldBlueprint()",
            "getHeightmap()",
            "getRegionMap()",
            "getRegionAt(x, z)",
            "isInsideWorld(x, z)"
         ],
         "notes": [
            "Owns Heightmap + RegionMap for the prime shard.",
            "Builds a WorldBlueprint via ScaledWorldgen.",
            "Implements WorldBlueprintProvider for RoomManager."
         ]
      },
      "world.navGrid": {
         "kind": "service",
         "path": "worldcore/world/NavGridManager.ts",
         "class": "NavGridManager",
         "lifecycle": "singleton",
         "ctorArgs": [
            "world.manager"
         ],
         "dependsOn": [
            "world.manager"
         ],
         "provides": [
            "init()"
         ],
         "notes": [
            "Stub v1; just logs init.",
            "Intended to own navmesh/pathing data keyed off ServerWorldManager."
         ]
      },
      "world.query": {
         "kind": "service",
         "path": "worldcore/world/WorldQueryService.ts",
         "class": "WorldQueryService",
         "lifecycle": "singleton",
         "ctorArgs": [],
         "dependsOn": [
            "db.main"
         ],
         "provides": [
            "look(shardId, regionId)",
            "inspectRegion(shardId, regionId)"
         ],
         "notes": [
            "DB-only read model: useful for admin tools, MUD look/inspect, etc.",
            "Does not mutate world state."
         ]
      },
      "world.regions": {
         "kind": "service",
         "path": "worldcore/world/RegionManager.ts",
         "class": "RegionManager",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.entities",
            "core.rooms",
            "world.respawns?",
            "mmo.shardService?"
         ],
         "dependsOn": [
            "core.entities",
            "core.rooms",
            "world.respawns?",
            "mmo.shardService?"
         ],
         "provides": [
            "initialize(regions: RegionDefinition[])",
            "getRegion(id)",
            "getAllRegions()",
            "assignEntityToRegion(entityId, regionId)",
            "handleEntityTransfer(entityId, fromRoomId, toRoomId)",
            "findRegionByRoom(roomId)",
            "getRespawnPoint(regionId)",
            "handleRespawnRequest(entityId)",
            "registerShardLink(shardService)",
            "getShardForRegion(regionId)"
         ],
         "notes": [
            "Authoritative registry of regions and their room ownership.",
            "Bridges entity/room world-space with MMO concepts like shards and respawns."
         ]
      },
      "world.respawns": {
         "kind": "service",
         "path": "worldcore/world/RespawnService.ts",
         "class": "RespawnService",
         "lifecycle": "singleton",
         "ctorArgs": [
            "world.manager",
            "world.spawnPoints",
            "world.characters",
            "core.entities"
         ],
         "dependsOn": [
            "world.manager",
            "world.spawnPoints",
            "world.characters",
            "core.entities"
         ],
         "provides": [
            "respawnCharacter(session, char)",
            "/* internal */ pickSpawnPointFor(char)"
         ],
         "notes": [
            "Central respawn logic: chooses spawn, heals entity, saves CharacterState.",
            "v3 behavior: respawn prefers a closer eligible settlement spawn over a graveyard; otherwise uses nearest graveyard (then nearest any).",
            "Settlement eligibility placeholder: variantId 'kos' or 'hostile' makes a settlement ineligible."
         ]
      },
      "world.services": {
         "kind": "composition_root",
         "path": "worldcore/world/WorldServices.ts",
         "factory": "createWorldServices",
         "lifecycle": "per-shard",
         "dependsOn": [
            "world.events",
            "core.sessions",
            "core.entities",
            "core.rooms",
            "world.manager",
            "world.regions",
            "world.spawns",
            "world.respawns",
            "world.navGrid",
            "world.boundary?",
            "world.spawnPoints",
            "world.query?",
            "world.navGrid?",
            "core.movement",
            "core.combat",
            "core.objectStream",
            "core.terrainStream",
            "core.tickEngine",
            "npc.manager?"
         ],
         "notes": [
            "Intended to construct and wire all world + core services for a shard.",
            "Current implementation in codebase has mismatched constructor calls; registry should be treated as the target shape for the eventual fixed WorldServices.ts."
         ]
      },
      "world.spawnPoints": {
         "kind": "service",
         "path": "worldcore/world/SpawnPointService.ts",
         "class": "SpawnPointService",
         "lifecycle": "singleton",
         "ctorArgs": [],
         "dependsOn": [
            "db.main"
         ],
         "provides": [
            "getSpawnPointsForRegion(shardId, regionId)",
            "getSpawnPointsNear(shardId, x, z, radius)"
         ],
         "notes": [
            "Thin DB facade over spawn_points table.",
            "Returns DbSpawnPoint objects with protoId/variantId."
         ]
      },
      "world.spawns": {
         "kind": "service",
         "path": "worldcore/world/SpawnService.ts",
         "class": "SpawnService",
         "lifecycle": "singleton",
         "ctorArgs": [
            "core.entities",
            "core.rooms",
            "world.regions?",
            "world.respawns?"
         ],
         "dependsOn": [
            "core.entities",
            "core.rooms",
            "world.regions?",
            "world.respawns?"
         ],
         "provides": [
            "spawnEntity(SpawnOptions)",
            "despawnEntity(DespawnOptions)"
         ],
         "notes": [
            "Controls spawning and despawning of entities with optional region + respawn integration.",
            "Some called methods (createEntity, unregister, placeEntityInRoom, removeEntityFromRoom) are aspirational and will need to be aligned with EntityManager/RoomManager."
         ]
      },
      "world.storage": {
         "kind": "service",
         "path": "worldcore/world/ServerWorldStorage.ts",
         "class": "ServerWorldStorage",
         "lifecycle": "per-shard",
         "ctorArgs": [
            "shardId",
            "db.shardStorage",
            "worldGeneratorFn",
            "options?"
         ],
         "dependsOn": [
            "db.shardStorage"
         ],
         "provides": [
            "loadOrGenerate()"
         ],
         "notes": [
            "Bridges worldgen pipeline and shard storage.",
            "Not currently invoked in the runtime core; used when building/loading shards."
         ]
      },
      "worldcore/data/items/ItemDatabase.ts": {
         "file": "worldcore/data/items/ItemDatabase.ts",
         "kind": "data_table",
         "layer": "data",
         "domain": "items",
         "exports": [
            "ItemDatabase"
         ],
         "dependsOn": [
            "worldcore/data/items/ItemTypes.ts"
         ],
         "notes": "Shared in-memory item database for basic herbs, ores, lumber, tools and magical resources; used for drops, rewards and simple inventories across MMO, webend and MUD."
      },
      "worldcore/data/items/ItemTypes.ts": {
         "file": "worldcore/data/items/ItemTypes.ts",
         "kind": "types",
         "layer": "data",
         "domain": "items",
         "exports": [
            "ItemCategory",
            "ItemRarity",
            "ResourceTag",
            "ItemDef"
         ],
         "dependsOn": [],
         "notes": "Canonical item model (categories, rarities, resource tags, base ItemDef) shared across all frontends and backends."
      },
      "worldcore/db/ChunkCache.ts": {
         "file": "worldcore/db/ChunkCache.ts",
         "kind": "service",
         "layer": "db",
         "domain": "world_cache",
         "exports": [
            "ChunkPayload",
            "ChunkCacheOptions",
            "ChunkCache"
         ],
         "dependsOn": [
            "worldcore/db/Database.ts",
            "worldcore/utils/logger.ts"
         ],
         "notes": "Redis-backed generic chunk cache used by future terrain/worldgen streaming (WGEv3, TerrainStream v3) to store arbitrary per-chunk payloads."
      },
      "worldcore/db/Database.ts": {
         "file": "worldcore/db/Database.ts",
         "kind": "infra",
         "layer": "db",
         "domain": "database",
         "exports": [
            "db",
            "redis",
            "testDbConnection",
            "ensureRedisConnected"
         ],
         "dependsOn": [
            "pg",
            "redis",
            "dotenv",
            "worldcore/utils/logger.ts"
         ],
         "notes": "Central Postgres and Redis connection layer with pooled DB access and lazy Redis connection; currently parked for when shard storage and other DB-backed systems go live."
      },
      "worldcore/db/ShardStorage.ts": {
         "file": "worldcore/db/ShardStorage.ts",
         "kind": "service",
         "layer": "db",
         "domain": "shards",
         "exports": [
            "ShardStorage"
         ],
         "dependsOn": [
            "worldcore/db/Database.ts",
            "worldcore/utils/logger.ts",
            "worldcore/shards/WorldBlueprint.ts"
         ],
         "notes": "Shard-level persistence helper for loading world blueprints (boundary, regions, objects, spawns) from the shards table into WorldBlueprint structures."
      },
      "worldcore/economy/EconomyHelpers.ts": {
         "file": "worldcore/economy/EconomyHelpers.ts",
         "kind": "helpers",
         "layer": "systems",
         "domain": "economy",
         "exports": [
            "SimpleItemStack",
            "ItemApplyResult",
            "getCharacterInventory",
            "getCharacterGold",
            "setCharacterGold",
            "giveGold",
            "trySpendGold",
            "removeItemQuantityFromInventory",
            "addItemQuantityToInventory",
            "giveItemsToCharacter",
            "takeItemsFromCharacter",
            "tryConsumeItems",
            "tryPayCost",
            "grantReward"
         ],
         "dependsOn": [
            "worldcore/characters/CharacterTypes.ts",
            "worldcore/items/InventoryHelpers.ts"
         ],
         "notes": "High-level gold and item helpers for characters: give/take gold, add/remove item quantities, cost checks and reward application for shops, quests and other systems."
      },
      "worldcore/factions/FactionTypes.ts": {
         "file": "worldcore/factions/FactionTypes.ts",
         "kind": "types",
         "layer": "systems",
         "domain": "factions",
         "exports": [
            "FactionId",
            "Faction",
            "getFactionById",
            "getAllFactions"
         ],
         "dependsOn": [],
         "notes": "Basic faction model and temporary in-memory faction registry (including test_empire) for early region control, naming and UI tests."
      },
      "worldcore/gathering/GatherTables.ts": {
         "file": "worldcore/gathering/GatherTables.ts",
         "kind": "data_table",
         "layer": "systems",
         "domain": "gathering",
         "exports": [
            "ResourceDrop",
            "HERB_TABLES"
         ],
         "dependsOn": [],
         "notes": "Weighted herb drop tables keyed by biome+tier (e.g. plains:1, plains:3, plains:5) used by gathering nodes to roll what items a harvest yields."
      },
      "worldcore/guilds/GuildService.ts": {
         "file": "worldcore/guilds/guildService.ts",
         "kind": "service",
         "layer": "systems",
         "domain": "guilds",
         "exports": [
            "GuildService"
         ],
         "dependsOn": [
            "worldcore/db/Database.ts"
         ],
         "notes": "DB-backed guild service for resolving a character's guild and listing guild members with rank and basic character info."
      },
      "worldcore/index.ts": {
         "file": "worldcore/index.ts",
         "kind": "barrel",
         "layer": "root",
         "domain": "worldcore_api",
         "exports": [
            "config/config",
            "config/logconfig",
            "config/worldscale",
            "shards/WorldBlueprint",
            "shared/region",
            "terrain",
            "terrain/worldgen/ScaledWorldgen"
         ],
         "dependsOn": [
            "worldcore/config/config",
            "worldcore/config/logconfig",
            "worldcore/config/worldscale",
            "worldcore/shards/WorldBlueprint.ts",
            "worldcore/shared/region.ts",
            "worldcore/terrain/index.ts",
            "worldcore/terrain/worldgen/ScaledWorldgen.ts"
         ],
         "notes": "Root worldcore barrel that re-exports config, shard blueprints, shared region types and terrain/worldgen entrypoints as a stable public API."
      },
      "worldgen.scaled": {
         "kind": "worldgen_factory",
         "path": "worldcore/terrain/worldgen/ScaledWorldgen.ts",
         "function": "buildWorldBlueprint",
         "dependsOn": [],
         "provides": [
            "buildWorldBlueprint(input:ShardWorldInput):WorldBlueprint"
         ],
         "notes": [
            "Ultra-light v1 worldgen: creates a dome boundary and a default spawn for a shard.",
            "Used directly by ServerWorldManager to build the prime shard blueprint."
         ]
      },
      "worldgen.v2.biomes": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Biomes.ts",
         "class": "WGEv2BiomesStage",
         "lifecycle": "stateless",
         "dependsOn": [
            "worldgen.v2.landforms",
            "worldgen.v2.erosion",
            "worldgen.v2.climate"
         ],
         "provides": [
            "run(input:BiomeInput, ctx?:WorldGenContext):BiomeResult"
         ],
         "notes": [
            "Stage 2.3.4 \u2013 biome assignment per cell + connected biome clusters.",
            "Outputs biomeMap + cluster IDs + counts per biome."
         ]
      },
      "worldgen.v2.civilization": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Civilization.ts",
         "class": "WGEv2CivilizationStage",
         "lifecycle": "stateless",
         "dependsOn": [
            "worldgen.v2.landforms",
            "worldgen.v2.erosion",
            "worldgen.v2.climate",
            "worldgen.v2.biomes"
         ],
         "provides": [
            "run(input:CivilizationInput, ctx?:WorldGenContext):CivilizationResult"
         ],
         "notes": [
            "Stage 2.3.5 \u2013 settlements, roads, and POIs.",
            "Scores candidate cells, picks settlements with spacing, builds a road graph, scatters points of interest."
         ]
      },
      "worldgen.v2.climate": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Climate.ts",
         "class": "WGEv2ClimateStage",
         "lifecycle": "stateless",
         "dependsOn": [
            "worldgen.v2.landforms",
            "worldgen.v2.erosion?"
         ],
         "provides": [
            "run(input:ClimateInput, ctx?:WorldGenContext):ClimateResult"
         ],
         "notes": [
            "Stage 2.3.3 \u2013 temperature, moisture, and compact climate zones.",
            "Can optionally use erosion outputs to bias humidity near rivers/lakes."
         ]
      },
      "worldgen.v2.erosion": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Erosion.ts",
         "class": "WGEv2ErosionStage",
         "lifecycle": "stateless",
         "dependsOn": [
            "worldgen.v2.landforms"
         ],
         "provides": [
            "run(input:{ landforms:LandformResult, params?:ErosionParams }, ctx?:WorldGenContext):ErosionResult"
         ],
         "notes": [
            "Stage 2.3.2 \u2013 hydrology, erosion, rivers, lakes.",
            "Outputs updated elevation, water, sediment, flow dirs, river/lake masks."
         ]
      },
      "worldgen.v2.landforms": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Landforms.ts",
         "class": "WGEv2LandformsStage",
         "lifecycle": "stateless",
         "dependsOn": [],
         "provides": [
            "run(input:ShardSeedInput, ctx?:WorldGenContext):LandformResult"
         ],
         "notes": [
            "Stage 2.3.1 \u2013 base landforms: tectonics, continents, uplift, macro elevation.",
            "First stage in the WGEv2 pipeline; everything else builds on its LandformResult."
         ]
      },
      "worldgen.v2.resources": {
         "kind": "worldgen_stage",
         "path": "worldcore/terrain/worldgen/WGEv2Resources.ts",
         "class": "WGEv2ResourcesStage",
         "lifecycle": "stateless",
         "dependsOn": [
            "worldgen.v2.landforms",
            "worldgen.v2.erosion",
            "worldgen.v2.climate",
            "worldgen.v2.biomes",
            "worldgen.v2.civilization"
         ],
         "provides": [
            "run(input:ResourceInput, ctx?:WorldGenContext):ResourceResult"
         ],
         "notes": [
            "Stage 2.3.6 \u2013 resource node placement (ore/herb/wood/fish/rare) plus per-kind masks.",
            "Respects biome, elevation, climate, hydrology, and avoids city centers while tagging 'near settlement' nodes."
         ]
      }
   }
}