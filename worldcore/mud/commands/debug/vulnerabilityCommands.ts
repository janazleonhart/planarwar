// worldcore/mud/commands/debug/vulnerabilityCommands.ts
//
// Debug helper for applying the generic Vulnerability debuff to yourself.
//
// Usage:
//   > debug_vuln [stacks]
//
// Examples:
//   > debug_vuln        -> apply 1 stack of Exposed Weakness
//   > debug_vuln 2      -> apply 2 stacks (up to maxStacks)
//
// Then:
//   > effects
//   to inspect the resulting damageTakenPct modifiers.

import type { MudContext } from "../../MudContext";
import type { CharacterState } from "../../../characters/CharacterTypes";
import type { MudCommandInput } from "../types";

import { applyVulnerability } from "../../../combat/Vulnerability";

export async function handleDebugVulnerability(
  _ctx: MudContext,
  char: CharacterState,
  input: MudCommandInput,
): Promise<string> {
  const rawStacks = input.args[0];
  const stacks = Number(rawStacks ?? "1");

  if (!Number.isFinite(stacks) || stacks <= 0) {
    return "[debug] Usage: debug_vuln [stacks]";
  }

  const clampedStacks = Math.max(1, Math.min(Math.floor(stacks), 10));
  const now = Date.now();

  applyVulnerability(char, clampedStacks, now);

  return `[debug] Applied Exposed Weakness x${clampedStacks} to you. Use 'effects' to inspect incoming damage modifiers.`;
}
