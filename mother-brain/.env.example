# Mother Brain v0.4
#
# Mother Brain loads env from:
#   1) mother-brain/.env (if present)
#   2) repo-root .env (../.env)
#   3) process env (systemd/docker/etc)

# Core knobs (safe defaults exist)
#MOTHER_BRAIN_TICK_MS=5000
#MOTHER_BRAIN_LOG_LEVEL=info   # debug|info|warn|error
#MOTHER_BRAIN_MODE=observe     # observe|apply (v0.4 is still observe-only)

# Optional probe timeouts (ms)
#MOTHER_BRAIN_DB_TIMEOUT_MS=2000
#MOTHER_BRAIN_WS_TIMEOUT_MS=2500

# Optional: WS ping/pong health measurement
# - When MOTHER_BRAIN_WS_URL is set, Mother Brain can periodically send a WS ping and measure pong latency.
# - Useful for verifying the room/socket server is reachable and responsive.
#MOTHER_BRAIN_WS_PING_EVERY_TICKS=3
#MOTHER_BRAIN_WS_PING_TIMEOUT_MS=2000

# Optional: DB brain:* spawn_points summary
# - Every N ticks, Mother Brain will query spawn_points WHERE spawn_id LIKE 'brain:%'
# - This is read-only, and meant for quick visibility while waves are being planned.
#MOTHER_BRAIN_SPAWN_SUMMARY_EVERY_TICKS=12
#MOTHER_BRAIN_SPAWN_SUMMARY_TOP_N=8

# DB connectivity (choose ONE style):
# Style A (recommended): Planar War legacy vars (bridged automatically)
#PW_DB_HOST=localhost
#PW_DB_PORT=5432
#PW_DB_USER=planarwar
#PW_DB_PASS=
#PW_DB_NAME=planarwar_main

# Style B: direct URL (overrides PW_DB_* bridging)
#MOTHER_BRAIN_DB_URL=postgresql://user:pass@localhost:5432/planarwar_main

# WS connectivity (required for ws_mud / ws_mud_script goals)
#
# IMPORTANT: Mother Brain must attach a character, otherwise the MessageRouter ignores "mud" ops.
# The web-frontend does this by connecting with URL params: token + characterId.
#
# You can provide a fully-qualified URL with params, OR (recommended) provide a base URL plus:
#   - MOTHER_BRAIN_WS_CHARACTER_ID
#   - (optional) MOTHER_BRAIN_WS_TOKEN
#
# If MOTHER_BRAIN_WS_TOKEN is omitted, Mother Brain will auto-sign a JWT using:
#   - PW_AUTH_JWT_SECRET
#   - MOTHER_BRAIN_TEST_USER_ID
#
# Base URL (no params needed here when using the vars below)
#MOTHER_BRAIN_WS_URL=ws://127.0.0.1:7777/ws

# Character to attach for MUD smoke tests (must belong to MOTHER_BRAIN_TEST_USER_ID)
#MOTHER_BRAIN_WS_CHARACTER_ID=

# Optional explicit JWT. If omitted, Mother Brain auto-signs using PW_AUTH_JWT_SECRET.
#MOTHER_BRAIN_WS_TOKEN=

# If true, ws.connected will FAIL (not skip) when WS is disabled (e.g. missing MOTHER_BRAIN_WS_URL).
# Use this when you expect Mother Brain to run player smoke continuously and want a hard signal.
#MOTHER_BRAIN_WS_REQUIRED=1

# If true, /readyz will return 503 when goals are enabled but goals health is not OK (FAIL/STALE).
# This is useful for systemd/monitoring: "ready" implies "playtests are passing".
#MOTHER_BRAIN_READY_REQUIRES_GOALS_OK=1

# Optional: schema awareness (read-only)
# How often to probe spawn_points existence/columns and report in tick snapshot.
MOTHER_BRAIN_SCHEMA_PROBE_EVERY_TICKS=30

#Log Location
PW_FILELOG=/home/rimuru/planarwar/log/{scope}.log

# Reduce log spam
MOTHER_BRAIN_TICK_LOG_EVERY_TICKS=6
MOTHER_BRAIN_TICK_LOG_ON_CHANGE=true

# -----------------------------------------------------------------------------
# Goals runner (v0.20)
# -----------------------------------------------------------------------------
# A safe, observe-only “test pilot” that runs small checks and writes structured
# JSONL reports.
#
# Defaults (if unset):
# - goals are ON: every 12 ticks
# - pack is player_smoke
# Set explicitly to 0 to disable.
#MOTHER_BRAIN_GOALS_EVERY_TICKS=12
#MOTHER_BRAIN_GOALS_FILE=./goals.json # optional hot-reload JSON array of goals
#MOTHER_BRAIN_GOALS_PACKS=player_smoke # optional builtin suites (ignored if GOALS_FILE is non-empty)
#MOTHER_BRAIN_GOALS_PACKS=core,web_smoke,admin_smoke,player_smoke # optional multi-suite selection
#MOTHER_BRAIN_GOALS_PACKS=all_smoke # convenience pack (core + web_smoke + admin_smoke + player_smoke)
#MOTHER_BRAIN_GOALS_REPORT_DIR=       # optional; defaults to dirname(PW_FILELOG)/mother-brain

# If enabled, Mother Brain will exit non-zero on goal failures (useful for systemd restarts / alerts).
#MOTHER_BRAIN_GOALS_FAILFAST=0

# Builtin packs that require service base URLs
#MOTHER_BRAIN_WEB_BACKEND_HTTP_BASE=http://127.0.0.1:4000 # enables web_smoke/admin_smoke packs (must be reachable from mother-brain; if running in Docker use host.docker.internal)
#MOTHER_BRAIN_WEB_BACKEND_ADMIN_TOKEN=changeme # optional: enables admin_smoke against protected /api/admin endpoints (fallback: PW_ADMIN_TOKEN)

# Daemon/prod auth (recommended over human tokens): service token support.
# - web-backend verifies this using PW_SERVICE_TOKEN_SECRET (recommended).
# - rotation: PW_SERVICE_TOKEN_SECRET_PREV can be set to accept the previous value during a cutover.
# - fallback: PW_AUTH_JWT_SECRET is accepted for dev convenience, but is not recommended for prod.
# - Mother Brain can send it via either Authorization Bearer or x-service-token.
# You can provide either a single generic token (legacy) OR role-scoped tokens.
# Role-scoped tokens let you keep least-privilege for read-only checks while still
# allowing editor/root-only checks where needed.
#
# Legacy (single token):
#MOTHER_BRAIN_WEB_BACKEND_SERVICE_TOKEN=svc:mother-brain:readonly:<sighex>
#
# Recommended (two tokens):
#MOTHER_BRAIN_WEB_BACKEND_SERVICE_TOKEN_READONLY=svc:mother-brain:readonly:<sighex>
#MOTHER_BRAIN_WEB_BACKEND_SERVICE_TOKEN_EDITOR=svc:mother-brain:editor:<sighex>


# MMO backend admin smoke (character lifecycle)
#MOTHER_BRAIN_MMO_BACKEND_HTTP_BASE=http://127.0.0.1:3001 # mmo-backend http base (same port as WS)
# Legacy (single token):
#MOTHER_BRAIN_MMO_BACKEND_SERVICE_TOKEN=svc:mother-brain:editor:<sighex>
#
# Recommended (role-scoped):
#MOTHER_BRAIN_MMO_BACKEND_SERVICE_TOKEN_READONLY=svc:mother-brain:readonly:<sighex>
#MOTHER_BRAIN_MMO_BACKEND_SERVICE_TOKEN_EDITOR=svc:mother-brain:editor:<sighex>
#MOTHER_BRAIN_TEST_USER_ID=<uuid> # required for admin.characters.smoke_cycle goal

# keep cleanup on (recommended)
#MOTHER_BRAIN_CLASS_PLAYTEST_DELETE_ON_FINISH=1

# avoid spamming your server every tick
#MOTHER_BRAIN_GOALS_EVERY_TICKS=30

# control how many classes per run (nice for incremental rollout)
#MOTHER_BRAIN_CLASS_PLAYTEST_MAX_PER_RUN=5