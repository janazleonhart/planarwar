{
  "conventions": {
    "adminPages": [
      "/admin/quests",
      "/admin/npcs",
      "/admin/items",
      "/admin/spawn_points"
    ],
    "apiConfig": {
      "currentAdminPages": "same-origin /api via Vite dev proxy (no hard-coded ADMIN_API_BASE)",
      "preferred": "(dev) Vite /api proxy; (override) VITE_API_BASE_URL when cross-origin is intentional"
    },
    "runtimePorts": {
      "mmo-backend.ws": 7777,
      "vite.dev": 5173,
      "web-backend": 4000
    }
  },
  "package": {
    "name": "planarwar-web-frontend",
    "runtime": "browser",
    "stack": [
      "vite",
      "react 18",
      "typescript"
    ],
    "version": "0.1.0"
  },
  "registryVersion": "1.0",
  "root": "web-frontend",
  "services": {
    "web-frontend.config.ts": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "data",
      "lifecycle": "static",
      "notes": [],
      "owns": [],
      "path": "web-frontend/tsconfig.json",
      "provides": [
        "TypeScript build configuration for Vite"
      ],
      "service": "tsconfig"
    },
    "web-frontend.config.vite": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "module",
      "lifecycle": "static",
      "notes": [
        "Proxy is required for same-origin /api requests when running the frontend on :5173 and backend on :4000; avoids CORS and index.html fallbacks.",
        "Plugin may be @vitejs/plugin-react or @vitejs/plugin-react-swc depending on installed deps."
      ],
      "owns": [],
      "path": "web-frontend/vite.config.ts",
      "provides": [
        "Vite dev server settings (host 0.0.0.0, port 5173)",
        "Dev proxy: /api -> http://127.0.0.1:4000 (web-backend)",
        "Optional WS proxy: /ws -> ws://127.0.0.1:7777/ws"
      ],
      "service": "vite.config"
    },
    "web-frontend.entry.indexHtml": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "doc",
      "lifecycle": "static",
      "notes": [
        "Client bootstrap for the Planar War web console + admin tools UI."
      ],
      "owns": [],
      "path": "web-frontend/index.html",
      "provides": [
        "Vite HTML entrypoint (mounts #root)"
      ],
      "service": "vite.entry"
    },
    "web-frontend.entry.main": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [
        "web-frontend.ui.app"
      ],
      "kind": "ui",
      "lifecycle": "static",
      "notes": [
        "Vite entrypoint; renders <App/>."
      ],
      "owns": [
        "DOM mount to #root"
      ],
      "path": "web-frontend/main.tsx",
      "provides": [
        "ReactDOM root render (StrictMode)"
      ],
      "service": "react.bootstrap"
    },
    "web-frontend.lib.api": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "module",
      "lifecycle": "static",
      "notes": [
        "Default behavior is same-origin (API_BASE_URL=\"\") to work cleanly with Vite dev proxy and avoid CORS.",
        "Set VITE_API_BASE_URL only when you intentionally want cross-origin calls (and have CORS configured).",
        "Used by vendor admin pages (AdminVendorEconomyPage/AdminVendorAuditPage) and city-builder pages (MePage/OperationsPage).",
        "Caution: keep secrets out of repo .env; Vite only exposes VITE_* at runtime, but secrets in-repo are still a security risk.",
        "Now attaches Authorization: Bearer <token> automatically if localStorage pw_auth_v1 is present (shared auth across MUD/CityBuilder).",
        "Adds helpers for CityBuilder city ops endpoints (/api/city/*)."
      ],
      "owns": [],
      "path": "web-frontend/lib/api.ts",
      "provides": [
        "Typed DTOs for city-builder UI (MeProfile, missions, armies, heroes, tech, etc.)",
        "API_BASE_URL from VITE_API_BASE_URL (default same-origin)",
        "fetchMe(), startTech(), api(path, init) with JSON/HTML guardrails",
        "auth header injection (pw_auth_v1)",
        "cityTierUp()",
        "cityMorph(specializationId)",
        "fetchCityDebug()"
      ],
      "service": "api.client"
    },
    "web-frontend.meta.envD": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "module",
      "lifecycle": "static",
      "notes": [],
      "owns": [],
      "path": "web-frontend/vite-env.d.ts",
      "provides": [
        "Vite TS env type declarations"
      ],
      "service": "vite.env"
    },
    "web-frontend.meta.package": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "data",
      "lifecycle": "static",
      "notes": [
        "axios is listed as a dependency but is not currently used in the checked-in TSX/TS files.",
        "Includes a 'typecheck' script (tsc --noEmit) for CI/local TS sanity checks."
      ],
      "owns": [],
      "path": "web-frontend/package.json",
      "provides": [
        "NPM scripts: dev/build/preview",
        "Dependencies: react/react-dom, devDependencies: vite, typescript"
      ],
      "service": "npm.package"
    },
    "web-frontend.components.itemPicker": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Reusable item id picker with server-backed autocomplete via /api/admin/items/options.",
        "Resolves (id -> name/rarity) and exposes validity for forms that must prevent dangling item references."
      ],
      "owns": [
        "client-side option cache for item lookups"
      ],
      "path": "web-frontend/components/ItemPicker.tsx",
      "provides": [
        "ItemPicker component (autocomplete + validation + resolved label)"
      ],
      "service": "ui.component"
    },
    "web-frontend.pages.adminItems": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Uses same-origin /api requests (dev via Vite proxy; prod via reverse proxy / same host).",
        "Endpoints: GET /api/admin/items?q&limit&offset; POST /api/admin/items; then refreshes list.",
        "Supports search + paging so item table growth doesn't break UX."
      ],
      "owns": [
        "client-side form state",
        "search + paging state (q/limit/offset)"
      ],
      "path": "web-frontend/pages/AdminItemsPage.tsx",
      "provides": [
        "Item list + edit/create UI",
        "Search + paging for item list",
        "Edits flagsText/statsText serialized fields"
      ],
      "service": "admin.items"
    },
    "web-frontend.pages.adminNpcs": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Uses same-origin /api requests (dev via Vite proxy; prod via reverse proxy / same host).",
        "Endpoints: GET /api/admin/npcs; POST /api/admin/npcs; then refreshes list.",
        "Loot editor uses ItemPicker backed by GET /api/admin/items/options for autocomplete + strict validation (blocks save if unknown item id)."
      ],
      "owns": [
        "client-side form state",
        "loot row validation state"
      ],
      "path": "web-frontend/pages/AdminNpcsPage.tsx",
      "provides": [
        "NPC list + edit/create UI",
        "Loot editor with item autocomplete + validation (chance/min/max)"
      ],
      "service": "admin.npcs"
    },
    "web-frontend.pages.adminQuests": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Uses same-origin /api requests (dev via Vite proxy; prod via reverse proxy / same host).",
        "Endpoints: GET /api/admin/quests; POST /api/admin/quests; then refreshes list."
      ],
      "owns": [
        "client-side form state"
      ],
      "path": "web-frontend/pages/AdminQuestsPage.tsx",
      "provides": [
        "Quest list + edit/create UI",
        "Objective kinds: kill/harvest/collect_item/talk_to",
        "Writes to /api/admin/quests"
      ],
      "service": "admin.quests"
    },
    "web-frontend.pages.adminSpawnPoints": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Uses same-origin /api requests (dev via Vite proxy; prod via reverse proxy / same host).",
        "Endpoints: GET /api/admin/spawn_points?..., POST /api/admin/spawn_points (create), PUT /api/admin/spawn_points/:id, bulk_delete, bulk_move, clone, scatter.",
        "Mother Brain endpoints: GET /api/admin/spawn_points/mother_brain/status, POST /api/admin/spawn_points/mother_brain/wave, POST /api/admin/spawn_points/mother_brain/wipe.",
        "Town Baseline endpoints: POST /api/admin/spawn_points/town_baseline/plan and /api/admin/spawn_points/town_baseline/apply.",
        "Handles Mother Brain destructive confirm_required (HTTP 409) flow: displays expectedConfirmToken and requires re-run with confirm token for commit when deletions would occur.",
        "Adds client-side quick search to narrow the loaded list without re-querying the server.",
        "Shows compact summary panels for wave/wipe/baseline results; raw JSON is tucked into <details> for sanity.",
        "Displays confirm token both when required (HTTP 409 confirm_required) and when merely available for later commit.",
        "Mother Brain ops UX: supports confirm_required flow with copy/fill token controls and per-parameter token scoping (token resets when inputs change).",
        "Wipe confirm adds an extra human-speed lock: type 'WIPE' before token entry/commit enables.",
        "Adds diff preview panel for Mother Brain wave/wipe (delete/insert/update/skip + export JSON).",
        "UI renders opsPreview diff previews for Mother Brain wave/wipe AND Town baseline plan/apply (with JSON export).",
        "Snapshot/Restore endpoints: POST /api/admin/spawn_points/snapshot, POST /api/admin/spawn_points/restore.",
        "Server snapshot endpoints: GET /api/admin/spawn_points/snapshots, POST /api/admin/spawn_points/snapshots/save, GET/DELETE /api/admin/spawn_points/snapshots/:id",
        "Restore safety UI: shows high-risk restore warning and requires confirm phrase 'RESTORE' for cross-shard and/or brain-owned restores, plus confirm token for destructive updates.",
        "P2\u2013P3: Server snapshots UI: save/load/delete spawn snapshot docs stored on web-backend.",
        "Snapshot save supports tags (comma list) + notes; list supports sort + tag filter + search via query params.",
        "Scatter tool uses server-provided protoId datalist (/api/admin/spawn_points/proto_options) with name+id labels and manual fallback.",
        "P2â€“P3: Server snapshots UI: save/load/delete spawn snapshot docs stored on web-backend.",
        "Snapshot save supports tags (comma list) + notes; list supports sort + tag filter + search via query params.",
        "Scatter tool uses server-provided protoId datalist (/api/admin/spawn_points/proto_options) with name+id labels and manual fallback.",
        "Scatter tool adds quick-pick chips (common protoIds) to reduce typos and speed placement; manual entry still allowed.",
        "Region filter adds quick-pick chips (common regionIds) to speed filtering without scrolling/typing."
      ],
      "owns": [
        "UI persistence in localStorage (adminSpawnPointsPage.ui.v1)",
        "selected rows + filter state",
        "Mother Brain wave/wipe responses"
      ],
      "path": "web-frontend/pages/AdminSpawnPointsPage.tsx",
      "provides": [
        "Spawn Points Editor (v1): browse/edit",
        "Client-side quick search (type/archetype/proto/spawn/region) over the loaded list",
        "Diff/summary panels for Mother Brain wave/wipe and Town Baseline plan/apply (plus expandable raw JSON)",
        "Batch tools: bulk delete/move, clone, scatter",
        "Mother Brain: status, list, wave (plan/commit), wipe (plan/commit)",
        "Town Baseline tool: plan/apply deterministic town/outpost services around a selected town spawn (mailbox/rest/guards/dummies/stations)",
        "Confirm-token safety UX for Mother Brain wave/wipe commits (409 confirm_required -> expectedConfirmToken -> Confirm + Commit)."
      ],
      "service": "admin.spawnPoints"
    },
    "web-frontend.pages.adminVendorAudit": {
      "class": "AdminVendorAuditPage",
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "page",
      "lifecycle": "page",
      "notes": [
        "Simple table UI with filters + pagination. Backed by /api/admin/vendor_audit.",
        "Server streaming CSV export.",
        "Uses ItemPicker for itemId filter; displays item name + rarity from API join."
      ],
      "owns": ["Admin UI for vendor_log"],
      "path": "web-frontend/pages/AdminVendorAuditPage.tsx",
      "provides": ["/admin/vendor_audit"],
      "service": "web.adminPages"
    },
    "web-frontend.pages.adminVendorEconomy": {
      "class": "AdminVendorEconomyPage",
      "ctorArgs": [],
      "dependsOn": [],
      "kind": "page",
      "lifecycle": "page",
      "notes": [
        "Editable vendor economy knobs (stockMax/restock cadence/price mults) with per-row save + optional stock reset.",
        "Uses ItemPicker for item filtering; displays item name + rarity from API join."
      ],
      "owns": ["Admin UI for vendor_item_economy"],
      "path": "web-frontend/pages/AdminVendorEconomyPage.tsx",
      "provides": ["/admin/vendor_economy"],
      "service": "web.adminPages"
    },
    "web-frontend.pages.me": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [
        "web-frontend.lib.api"
      ],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Not currently routed from App.tsx.",
        "Endpoints used include: /api/me, /api/tech/start, /api/missions/start, /api/missions/complete, /api/missions/refresh_region, /api/buildings/construct, /api/buildings/upgrade, /api/city/tier-up, /api/warfront/assault, /api/armies/raise, /api/armies/reinforce, /api/garrisons/strike, /api/heroes/equip_attachment, /api/heroes/recruit, /api/workshop/craft, /api/workshop/collect, /api/policies/toggle."
      ],
      "owns": [
        "client-side UI state for selected actions",
        "optimistic refresh loops calling fetchMe()"
      ],
      "path": "web-frontend/pages/MePage.tsx",
      "provides": [
        "City-builder dashboard: city status + buildings + tech + missions + armies/heroes + policies",
        "Action buttons that POST to various /api/* endpoints"
      ],
      "service": "cityBuilder.me"
    },
    "web-frontend.pages.operations": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [
        "web-frontend.lib.api"
      ],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Routed via CityShellPage (CityBuilder tab).",
        "Shows active missions from fetchMe() (GET /api/me).",
        "Adds basic City ops: tier-up and morph (POST /api/city/tier-up, POST /api/city/morph), with optional GET /api/city debug read.",
        "CityBuilder legacy payload: mission fields may be absent; treat activeMissions/missionId as optional to avoid TS drift."
      ],
      "owns": [
        "client-side fetchMe() state"
      ],
      "path": "web-frontend/pages/OperationsPage.tsx",
      "provides": [
        "Read-only operations view (active missions)",
        "City ops buttons (tier-up, morph) + last-result inspector"
      ],
      "service": "cityBuilder.operations"
    },
    "web-frontend.ui.app": {
      "class": null,
      "ctorArgs": [],
      "dependsOn": [
        "web-frontend.pages.adminQuests",
        "web-frontend.pages.adminNpcs",
        "web-frontend.pages.adminItems",
        "web-frontend.pages.adminSpawnPoints"
      ],
      "kind": "ui",
      "lifecycle": "singleton",
      "notes": [
        "Legacy App.tsx contains its own API_BASE/SHARD_WS computed from window.location.hostname (with localhost fallback).",
        "Admin pages now use same-origin /api (recommended) via Vite proxy in dev.",
        "Endpoints used by the legacy App layer include: /api/auth/login, /api/auth/register, /api/characters (GET/POST), /api/characters/:id (GET), /api/spells?ids=\u2026, /api/items?ids=\u2026, /api/abilities\u2026",
        "WebSocket sends ops: whereami, mud; expects mud_result, whereami_result, chat payloads.",
        "City-builder pages (MePage/OperationsPage) exist but are not currently routed from App.tsx.",
        "2026-01-28: Player Panels meta wired end-to-end: Inventory/Equipment uses /api/items, Spellbook uses /api/spells (q/ids) with cost+cooldown display, Abilities uses /api/abilities (DB catalog + unlock join).",
        "App.tsx is large; keep known-good commits before major UI polish passes to avoid JSX cascade errors."
      ],
      "owns": [
        "auth token persistence in localStorage (pw_auth_v1)",
        "selected character id",
        "WebSocket connection + log buffer",
        "spell meta cache (by id)",
        "item meta cache (by id)",
        "ability meta cache (by id)"
      ],
      "path": "web-frontend/App.tsx",
      "provides": [
        "Login/register UI (JWT)",
        "Character list + create character",
        "CharacterState debug viewer",
        "Shard WebSocket console (MUD command input)",
        "Admin UI routes via pathname (/admin/*) gated by account flags/adminRole",
        "Player Panels: Spellbook (meta via /api/spells)",
        "Player Panels: Abilities (meta via /api/abilities, command: /ability <id> [target])",
        "Player Panels: Inventory/Equipment (meta via /api/items)",
        "Player Panels: Effects (StatusEffects v1.5 MVP view)"
      ],
      "service": "webConsole.app"
    }
  }
}
